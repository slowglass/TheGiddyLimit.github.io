"use strict";class TimeTracker{static $getTracker(e,t){const n=$(`<div class="w-100 h-100 dm-time__root dm__data-anchor"/>`).data("getState",()=>a.getSaveableState()),a=new TimeTrackerRoot(e,n);return a.setStateFrom(t),a.render(n),n}}class TimeTrackerUtil{static pGetUserWindBearing(e){return InputUiUtil.pGetUserDirection({title:"Wind Bearing (Direction)",default:e,stepButtons:["N","NE","E","SE","S","SW","W","NW"]})}static revSlugToText(e){return e.split("-").reverse().map(e=>e.split("|").join("- ")).join(" ").toTitleCase()}}class TimeTrackerComponent extends BaseComponent{constructor(e,t,n){super(),n=n||{},this._board=e,this._$wrpPanel=t,n.isTemporary||this._addHookAll("state",()=>this._board.doSaveStateDebounced())}getPod(){const e=super.getPod();return e.triggerMapUpdate=e=>this._triggerMapUpdate(e),e}_triggerMapUpdate(e){this._state[e]=Object.values(this._state[e]).filter(e=>!e.isDeleted).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{})}}class TimeTrackerBase extends TimeTrackerComponent{_getTimeInfo(e){var t=Math.floor,n=Math.max,a=Math.round;e=e||{};let d;d=null==e.numSecs?!e.isBase&&this._state.isBrowseMode&&null!=this._state.browseTime?a(this._state.browseTime/1e3):a(this._state.time/1e3):e.numSecs,d=n(0,d);const s=this._state.secondsPerMinute,i=s*this._state.minutesPerHour,o=i*this._state.hoursPerDay,r=t(d/o);d-=r*o;const u=t(d/i);d-=u*i;const p=t(d/s);d-=p*s;const c=Object.values(this._state.months).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.pos,t.pos)),l=Object.values(this._state.days).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.pos,t.pos)),_=Object.values(this._state.seasons).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.startDay,t.startDay)),f=Object.values(this._state.years).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.year,t.year)),m=Object.values(this._state.eras).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.startYear,t.startYear)),g=o*c.map(e=>e.days).reduce((e,t)=>e+t,0),h=l.length,S=r%h,E=c.map(e=>e.days).reduce((e,t)=>e+t,0),y=r%E,T={secsPerMinute:s,minutesPerHour:this._state.minutesPerHour,hoursPerDay:this._state.hoursPerDay,secsPerHour:i,secsPerDay:o,secsPerWeek:o*h,secsPerYear:g,daysPerWeek:h,daysPerYear:E,monthsPerYear:c.length,numSecs:d,numMinutes:p,numHours:u,numDays:r,timeOfDaySecs:d+p*s+u*i,date:0,month:0,year:0,dayOfWeek:S,dayOfYear:y,monthStartDay:0,monthInfo:{...c[0]},prevMonthInfo:{...c.last()},nextMonthInfo:{...(c[1]||c[0])},dayInfo:{...l[S]},monthStartDayOfYear:0,weekOfYear:0,seasonInfos:[],yearInfos:[],eraInfos:[]};let D=r;outer:for(;0<D;){for(let e=0;e<c.length;++e){const t=c[e];for(let n=0;n<t.days;++n,--D)if(0===D){T.date=n,T.month=e,T.monthInfo={...t},0<e&&(T.prevMonthInfo=c[e-1]),T.nextMonthInfo=e<c.length-1?c[e+1]:c[0];break outer}T.monthStartDayOfYear+=t.days}T.year++,T.monthStartDayOfYear%=E}if(T.monthStartDay=(r-T.date)%h,_.length&&(T.seasonInfos=_.filter(e=>y>=e.startDay&&y<=e.endDay)),T.year+=this._state.offsetYears,T.monthStartDay+=this._state.offsetMonthStartDay,T.monthStartDay%=h,T.weekOfYear=T.year*(E%h)%h,f.length&&(T.yearInfos=f.filter(e=>T.year===e.year)),m.length&&(T.eraInfos=m.filter(e=>T.year>=e.startYear&&T.year<=e.endYear).map(e=>{const t=MiscUtil.copy(e);return t.dayOfEra=T.year-t.startYear,t})),null!=e.year||null!=e.dayOfYear){const t=a((this._state.isBrowseMode&&null!=this._state.browseTime?this._state.browseTime:this._state.time)/1e3),n=null==e.year?0:(T.year-e.year)*g,d=null==e.dayOfYear?0:(y-e.dayOfYear)*o;return this._getTimeInfo({numSecs:t-(n+d)})}return T}_getEvents(e,t){return this._getEncountersEvents("events",e,t)}_getEncounters(e,t){return this._getEncountersEvents("encounters",e,t)}_getEncountersEvents(e,t,n){return Object.values(this._state[e]).filter(e=>!e.isDeleted).filter(e=>{if(null!=e.when.year&&null!=e.when.day)return e.when.year===t&&e.when.day===n}).sort((e,t)=>e.hasTime&&!t.hasTime?1:!e.hasTime&&t.hasTime?-1:e.hasTime&&t.hasTime?SortUtil.ascSort(e.timeOfDaySecs,t.timeOfDaySecs)||SortUtil.ascSort(e.pos,t.pos):SortUtil.ascSort(e.pos,t.pos))}_getMoonInfos(e){var t=Math.floor;const n=Object.values(this._state.moons).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.phaseOffset,t.phaseOffset)||SortUtil.ascSort(e.name,t.name));return n.map(n=>{if(0>=n.period)throw new Error(`Invalid moon period "${n.period}", should be greater than zero!`);const a=e-n.phaseOffset;let d=a%n.period;for(;0>d;)d+=n.period;const s=t(8*(d/n.period)),i=TimeTrackerBase._MOON_PHASES[8===s?0:s],o=t(8*((d-1)/n.period))===s-1;return{color:n.color,name:n.name,period:n.period,phaseName:i.split("-").map(e=>e.uppercaseFirst()).join(" "),phaseFirstDay:o,phaseIndex:s,dayOfPeriod:d}})}_getAllDayInfos(){return Object.values(this._state.days).filter(e=>!e.isDeleted).sort((e,t)=>SortUtil.ascSort(e.pos,t.pos))}_doModTime(e,t){t=t||{};const n=!t.isBase&&this._state.isBrowseMode&&null!=this._state.browseTime?"browseTime":"time",a=this._state[n];this._state[n]=Math.max(0,a+Math.round(1e3*e))}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE}}getPod(){const e=super.getPod();return e.getTimeInfo=this._getTimeInfo.bind(this),e.getEvents=this._getEvents.bind(this),e.getEncounters=this._getEncounters.bind(this),e.getMoonInfos=this._getMoonInfos.bind(this),e.doModTime=this._doModTime.bind(this),e.getAllDayInfos=this._getAllDayInfos.bind(this),e}static getGenericDay(e){return{...TimeTrackerBase._DEFAULT_STATE__DAY,id:CryptUtil.uid(),name:`${Parser.numberToText(e+1)}day`.uppercaseFirst(),pos:e}}static getGenericMonth(e){return{...TimeTrackerBase._DEFAULT_STATE__MONTH,id:CryptUtil.uid(),name:`${Parser.numberToText(e+1)}uary`.uppercaseFirst(),days:30,pos:e}}static getGenericEvent(e,t,n,a){const d={...MiscUtil.copy(TimeTrackerBase._DEFAULT_STATE__EVENT),id:CryptUtil.uid(),pos:e};return null!=t&&(d.when.year=t),null!=n&&(d.when.day=n),null!=a&&(d.timeOfDaySecs=a,d.hasTime=!0),d}static getGenericEncounter(e,t,n,a){const d={...MiscUtil.copy(TimeTrackerBase._DEFAULT_STATE__ENCOUNTER),id:CryptUtil.uid(),pos:e};return null!=t&&(d.when.year=t),null!=n&&(d.when.day=n),null!=a&&(d.timeOfDaySecs=a,d.hasTime=!0),d}static getGenericSeason(e){return{...TimeTrackerBase._DEFAULT_STATE__SEASON,id:CryptUtil.uid(),name:`Season ${e+1}`,startDay:90*e,endDay:90*(e+1)-1}}static getGenericYear(e){return{...TimeTrackerBase._DEFAULT_STATE__YEAR,id:CryptUtil.uid(),name:`Year of the ${Parser.numberToText(e+1).uppercaseFirst()}s`,year:e}}static getGenericEra(e){const t=Parser.ALPHABET[e%Parser.ALPHABET.length];return{...TimeTrackerBase._DEFAULT_STATE__ERA,id:CryptUtil.uid(),name:`${Parser.getOrdinalForm(e+1)} Era`,abbreviation:`${t}E`,startYear:e,endYear:e}}static getGenericMoon(e){return{...TimeTrackerBase._DEFAULT_STATE__MOON,id:CryptUtil.uid(),name:`Moon ${e+1}`}}static formatDateInfo(e,t,n,a){return`${e.name||"[Nameless day]"} ${Parser.getOrdinalForm(t+1)} ${n.name||"[Nameless month]"}${a.length?` (${a.map(e=>e.name||"[Nameless season]").join("/")})`:""}`}static formatYearInfo(e,t,n,a){return`Year ${e+1}${t.length?` (<span class="italic">${t.map(e=>e.name.escapeQuotes()).join("/")}</span>)`:""}${n.length?`, ${n.map(e=>`${e.dayOfEra+1} <span ${a?`title="${e.name.escapeQuotes()}"`:``}>${(a?e.abbreviation:e.name).escapeQuotes()}</span>${a?"":` (${e.abbreviation.escapeQuotes()})`}`).join("/")}`:""}`}static $getCvsMoon(e){var t=Math.PI;const n=$(`<canvas title="${e.name.escapeQuotes()}\u2014${e.phaseName}" class="dm-time__cvs-moon" width="${TimeTrackerBase._MOON_RENDER_RES}" height="${TimeTrackerBase._MOON_RENDER_RES}"/>`),a=n[0],d=a.getContext("2d");return TIME_TRACKER_MOON_SPRITE.hasError||d.drawImage(TIME_TRACKER_MOON_SPRITE,e.phaseIndex*TimeTrackerBase._MOON_RENDER_RES,0,TimeTrackerBase._MOON_RENDER_RES,TimeTrackerBase._MOON_RENDER_RES,0,0,TimeTrackerBase._MOON_RENDER_RES,TimeTrackerBase._MOON_RENDER_RES),d.globalCompositeOperation="multiply",d.fillStyle=e.color,d.rect(0,0,TimeTrackerBase._MOON_RENDER_RES,TimeTrackerBase._MOON_RENDER_RES),d.fill(),d.closePath(),d.globalCompositeOperation="source-over",d.beginPath(),d.arc(TimeTrackerBase._MOON_RENDER_RES/2,TimeTrackerBase._MOON_RENDER_RES/2,TimeTrackerBase._MOON_RENDER_RES/2,0,2*t),d.lineWidth=6,d.stroke(),d.closePath(),n}static getClockInputs(e,t,n){var a=Math.min,d=Math.max;const s=e=>+e.val().trim().replace(/^0+/g,"");let i=t.timeOfDaySecs;const o=()=>{const e=r.map(e=>s(e.$ipt)*e.mult).reduce((e,t)=>e+t,0);i!==e&&(i=e,n(e))},r=[],u=(n,i,r,u)=>{const p=$(`<input class="form-control input-xs form-control--minimal text-center dm-time__ipt-event-time code mx-1" title="${n}">`).change(()=>{const t=e[i]-1,n=s(p),r=d(0,a(t,n));p.val(TimeTrackerBase.getPaddedNum(r,e[i])),o()}).click(()=>p.select()).val(TimeTrackerBase.getPaddedNum(t[r],e[i]));return{$ipt:p,propMax:i,mult:u?e[u]:1}},p=u("Hours","hoursPerDay","hours","secsPerHour"),c=u("Minutes","minutesPerHour","minutes","secsPerMinute"),l=u("Seconds","secsPerMinute","seconds");r.push(p,c,l);const _={$iptHours:p.$ipt,$iptMinutes:c.$ipt,$iptSeconds:l.$ipt};return o(),_}static getHoursMinutesSecondsFromSeconds(e,t,n){var a=Math.floor;const d=a(n/e);n-=d*e;const s=a(n/t);return n-=s*t,{seconds:n,minutes:s,hours:d}}static getPaddedNum(e,t){return`${e}`.padStart(`${t}`.length,"0")}}TimeTrackerBase._DEFAULT_STATE__DAY={name:"Day",isDeleted:!1},TimeTrackerBase._DEFAULT_STATE__MONTH={name:"Month",days:30,isDeleted:!1},TimeTrackerBase._DEFAULT_STATE__EVENT={name:"Event",entries:[],when:{year:0,day:0},isDeleted:!1,isHidden:!1},TimeTrackerBase._DEFAULT_STATE__ENCOUNTER={name:"Encounter",when:{year:0,day:0},isDeleted:!1,countUses:0},TimeTrackerBase._DEFAULT_STATE__SEASON={name:"Season",startDay:0,endDay:0,sunriseHour:6,sunsetHour:22,isDeleted:!1},TimeTrackerBase._DEFAULT_STATE__YEAR={name:"Year",year:0,isDeleted:!1},TimeTrackerBase._DEFAULT_STATE__ERA={name:"Era",abbreviation:"E",startYear:0,endYear:0,isDeleted:!1},TimeTrackerBase._DEFAULT_STATE__MOON={name:"Moon",color:"#ffffff",phaseOffset:0,period:24,isDeleted:!1},TimeTrackerBase._DEFAULT_STATE={time:0,browseTime:null,isBrowseMode:!1,hoursPerDay:24,minutesPerHour:60,secondsPerMinute:60,hoursPerLongRest:8,minutesPerShortRest:60,secondsPerRound:6,offsetYears:0,offsetMonthStartDay:0,days:{...[...Array(7)].map((e,t)=>TimeTrackerBase.getGenericDay(t)).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{})},months:{...[...Array(12)].map((e,t)=>TimeTrackerBase.getGenericMonth(t)).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{})},events:{},encounters:{},seasons:{...[...[,,,,]].map((e,t)=>TimeTrackerBase.getGenericSeason(t)).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{})},years:{},eras:{},moons:{...[...[,]].map((e,t)=>TimeTrackerBase.getGenericMoon(t)).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{})}},TimeTrackerBase._MOON_PHASES=["new-moon","waxing-crescent","first-quarter","waxing-gibbous","full-moon","waning-gibbous","last-quarter","waning-crescent"],TimeTrackerBase._MOON_RENDER_RES=32,TimeTrackerBase._MIN_TIME=1,TimeTrackerBase._MAX_TIME=9999;class TimeTrackerRoot extends TimeTrackerBase{constructor(e,t){super(e,t),this._compClock=new TimeTrackerRoot_Clock(e,t),this._compCalendar=new TimeTrackerRoot_Calendar(e,t),this._compSettings=new TimeTrackerRoot_Settings(e,t)}getSaveableState(){return{...this.getBaseSaveableState(),compClockState:this._compClock.getSaveableState(),compCalendarState:this._compCalendar.getSaveableState(),compSettingsState:this._compSettings.getSaveableState()}}setStateFrom(e){this.setBaseSaveableStateFrom(e),e.compClockState&&this._compClock.setStateFrom(e.compClockState),e.compCalendarState&&this._compCalendar.setStateFrom(e.compCalendarState),e.compSettingsState&&this._compSettings.setStateFrom(e.compSettingsState)}render(e){e.empty();const t=$(`<div class="flex-col w-100 h-100 overflow-y-auto">`),n=$(`<div class="flex-col w-100 h-100 overflow-y-auto flex-h-center">`),a=$(`<div class="flex-col w-100 h-100 overflow-y-auto">`),d=this.getPod();this._compClock.render(t,d),this._compCalendar.render(n,d),this._compSettings.render(a,d);const s=$(`<button class="btn btn-xs btn-default mr-2" title="Clock"><span class="glyphicon glyphicon-time"></span></button>`).click(()=>this._state.tab=0),i=$(`<button class="btn btn-xs btn-default mr-3" title="Calendar"><span class="glyphicon glyphicon-calendar"></span></button>`).click(()=>this._state.tab=1),o=$(`<button class="btn btn-xs btn-default mr-3" title="Settings"><span class="glyphicon glyphicon-cog"></span></button>`).click(()=>this._state.tab=2),r=()=>{s.toggleClass("active",0===this._state.tab),i.toggleClass("active",1===this._state.tab),o.toggleClass("active",2===this._state.tab),t.toggleClass("hidden",0!==this._state.tab),n.toggleClass("hidden",1!==this._state.tab),a.toggleClass("hidden",2!==this._state.tab)};this._addHookBase("tab",r),r();const u=$(`<button class="btn btn-xs btn-danger" title="Reset Clock/Calendar Time to First Day"><span class="glyphicon glyphicon-refresh"></span></button>`).click(()=>confirm("Are you sure?")&&Object.assign(this._state,{time:0,isBrowseMode:!1,browseTime:null}));$$`<div class="flex-col h-100">
			<div class="flex p-1 no-shrink">
				${s}${i}${o}${u}
			</div>
			<hr class="hr-0 mb-2 no-shrink">
			${t}
			${n}
			${a}
		</div>`.appendTo(e);const p=(e,t)=>{let n=!1;Object.values(this._state[t]).forEach(t=>{null!=t.when.year&&null!=t.when.day&&t.when.day>=e&&(t.when.day=e-1,n=!0)}),n&&this._triggerMapUpdate(t)},c=()=>{const{daysPerYear:e}=this._getTimeInfo({isBase:!0});p(e,"events"),p(e,"encounters")};this._addHookBase("months",c),c();const l=(e,t)=>{let n=!1;Object.values(this._state[t]).forEach(t=>{null!=t.timeOfDaySecs&&t.timeOfDaySecs>=e&&(t.timeOfDaySecs=e-1,n=!0)}),n&&this._triggerMapUpdate(t)},_=()=>{const{secsPerDay:e}=this._getTimeInfo({isBase:!0});l(e,"events"),l(e,"encounters")};this._addHookBase("secondsPerMinute",_),this._addHookBase("minutesPerHour",_),this._addHookBase("hoursPerDay",_),_()}_getDefaultState(){return{...super._getDefaultState(),...TimeTrackerRoot._DEFAULT_STATE}}}TimeTrackerRoot._DEFAULT_STATE={tab:0,isPaused:!1,isAutoPaused:!1,hasCalendarLabelsColumns:!0,hasCalendarLabelsRows:!1,unitsWindSpeed:"mph",isClockSectionHidden:!1,isCalendarSectionHidden:!1,isMechanicsSectionHidden:!1,isOffsetsSectionHidden:!1,isDaysSectionHidden:!1,isMonthsSectionHidden:!1,isSeasonsSectionHidden:!1,isYearsSectionHidden:!1,isErasSectionHidden:!1,isMoonsSectionHidden:!1};class TimeTrackerRoot_Clock extends TimeTrackerComponent{constructor(e,t){super(e,t),this._compWeather=new TimeTrackerRoot_Clock_Weather(e,t),this._ivTimer=null}getSaveableState(){return{...this.getBaseSaveableState(),compWeatherState:this._compWeather.getSaveableState()}}setStateFrom(e){this.setBaseSaveableStateFrom(e),e.compWeatherState&&this._compWeather.setStateFrom(e.compWeatherState)}render(e,t){e.empty(),this._parent=t;const{getTimeInfo:n,getMoonInfos:a,doModTime:d,getEvents:s,getEncounters:i}=t;clearInterval(this._ivTimer);let o=Date.now();this._ivTimer=setInterval(()=>{const e=Date.now(),t=e-o;o=e;this._parent.get("isPaused")||this._parent.get("isAutoPaused")||this._parent.set("time",this._parent.get("time")+t)},1e3),this._$wrpPanel.data("onDestroy",()=>clearInterval(this._ivTimer));const r=$(`<div class="small-caps"/>`),u=$(`<div class="small-caps small text-muted mb-2"/>`),p=$(`<div class="flex flex-wrap w-100 no-shrink flex-vh-center mb-3"/>`),c=$(`<div class="flex w-100 no-shrink flex-h-center flex-v-baseline mt-2"/>`),l=e=>{const{secsPerMinute:t,secsPerHour:n,secsPerDay:a,numSecs:d,numMinutes:s,numHours:i}=e;return a-(i*n+s*t+d)},_=$(`<button class="btn btn-xs btn-default mr-2" title="Skip time to the next sunrise. Skips to later today if it is currently night time, or to tomorrow otherwise.">Next Sunrise</button>`).click(()=>{const e=n({isBase:!0}),{seasonInfos:t,numHours:a,numMinutes:s,numSecs:i,secsPerHour:o,secsPerMinute:r}=e,u=t[0].sunriseHour;if(u>this._parent.get("hoursPerDay"))return JqueryUtil.doToast({content:"Could not skip to next sunrise\u2014sunrise time is greater than the number of hours in a day!",type:"warning"});if(a<u){d(u*o-(o*a+r*s+i),{isBase:!0})}else{const t=l(e);d(t+o*u,{isBase:!0})}}),f=$(`<button class="btn btn-xs btn-default" title="Skip time to next midnight.">Next Day</button>`).click(()=>d(l(n({isBase:!0})),{isBase:!0})),m=(e,t,a)=>{const s=$(`<input class="form-control form-control--minimal text-center dm-time__ipt-time code mx-1">`).change(()=>{const e=n({isBase:!0}),i=a?e[a]:1,o=e[t]*i,r=+s.val().trim().replace(/^0+/g,""),u=(isNaN(r)?0:r)*i;d(u-o,{isBase:!0})}).click(()=>s.select()).focus(()=>this._parent.set("isAutoPaused",!0)).blur(()=>this._parent.set("isAutoPaused",!1)),i=()=>{const t=`${this._parent.get(e)}`.length;s.css("width",20*t)};return this._parent.addHook(e,i),i(),s},g=(e,t,n)=>{e.is(":focus")||e.val(TimeTrackerBase.getPaddedNum(n,this._parent.get(t)))},h=m("hoursPerDay","numHours","secsPerHour"),S=m("minutesPerHour","numMinutes","secsPerMinute"),E=m("secondsPerMinute","numSecs"),y=$(`<div class="small-caps text-center mb-1"/>`),T=$$`<div class="flex flex-vh-center">${h}</div>`,D=$$`<div class="flex flex-vh-center">${S}</div>`,P=$$`<div class="flex flex-vh-center">${E}</div>`,M=$(`<div class="flex-vh-center relative flex-wrap dm-time__wrp-clock-events"/>`),I=$(`<hr class="hr-2">`);let k=null,C=null,H=null,A=null,v=null,O=null,w=null;const R=()=>{const{numDays:e,numHours:t,numMinutes:d,numSecs:o,dayInfo:l,date:f,monthInfo:m,seasonInfos:T,year:D,yearInfos:P,eraInfos:R,dayOfYear:b,secsPerHour:N,secsPerMinute:U,minutesPerHour:x,hoursPerDay:B}=n({isBase:!0}),W=a(e);CollectionUtil.deepEquals(A,W)||(A=W,p.empty(),W.length?(p.show(),W.forEach(e=>{$$`<div class="flex-v-center mr-2 ui-tip__parent">
							${TimeTrackerBase.$getCvsMoon(e).addClass("mr-2").addClass("dm-time__clock-moon-phase").attr("title",null)} 
							<div class="flex-col ui-tip__child">
								<div class="flex">${e.name}</div>
								<div class="flex small"><i class="mr-1 no-wrap">${e.phaseName}</i><span class="text-muted no-wrap">(Day ${e.dayOfPeriod+1}/${e.period})</span></div>				
							</div>
						</div>`.appendTo(p)})):p.hide());const F=TimeTrackerBase.formatDateInfo(l,f,m,T);F!==k&&(k=F,r.text(F));const L=TimeTrackerBase.formatYearInfo(D,P,R,!0);if(L!==C&&(C=L,u.html(L)),H!==e&&(H=e,y.text(`Day ${e+1}`)),g(h,"hoursPerDay",t),g(S,"minutesPerHour",d),g(E,"secondsPerMinute",o),T.length){c.removeClass("hidden");const e=T.map(e=>{const n=t>=e.sunriseHour&&t<e.sunsetHour,a=n?e.sunsetHour-t:t<e.sunriseHour?e.sunriseHour-t:this._parent.get("hoursPerDay")+e.sunriseHour-t;return`<b class="mr-2">${n?"Day":"Night"}</b> <span class="small text-muted">(${1===a?`Less than 1 hour`:`More than ${a-1} hour${2===a?"":"s"}`} to sun${n?"set":"rise"})</span>`}).join("/");e!==v&&(c.html(e),v=e),_.removeClass("hidden")}else c.addClass("hidden"),_.addClass("hidden");const Y=MiscUtil.copy(s(D,b)),G=MiscUtil.copy(i(D,b));CollectionUtil.deepEquals(O,Y)&&CollectionUtil.deepEquals(w,G)||(O=Y,w=G,M.empty(),O.length||w.length?(I.show(),M.show(),Y.forEach(e=>{const t=$$`<div class="dm-time__disp-clock-entry dm-time__disp-clock-entry--event">*</div>`.mouseover(n=>{let a=e.name;if(e.hasTime){const{hours:t,minutes:n,seconds:d}=TimeTrackerBase.getHoursMinutesSecondsFromSeconds(N,U,e.timeOfDaySecs);a=`${a} at ${TimeTrackerBase.getPaddedNum(t,B)}:${TimeTrackerBase.getPaddedNum(n,x)}:${TimeTrackerBase.getPaddedNum(d,U)}`}const d={name:a,type:"entries",entries:e.entries,data:{hoverTitle:a}};Renderer.hover.doHover(n,t[0],d,!0)}).click(()=>{const t=TimeTrackerRoot_Settings_Event.getInstance(this._board,this._$wrpPanel,this._parent,e);t.doOpenEditModal(null)}).appendTo(M)}),G.forEach(e=>{const t=$$`<div class="dm-time__disp-clock-entry dm-time__disp-clock-entry--encounter ${e.countUses?"dm-time__disp-clock-entry--used-encounter":""}" title="${e.countUses?"(Encounter has been used)":"Run Encounter (Add to Initiative Tracker)"}">*</div>`.mouseover(n=>{let a=null==e.displayName?e.name||"(Unnamed Encounter)":e.displayName;if(e.hasTime){const{hours:t,minutes:n,seconds:d}=TimeTrackerBase.getHoursMinutesSecondsFromSeconds(N,U,e.timeOfDaySecs);a=`${a} at ${TimeTrackerBase.getPaddedNum(t,B)}:${TimeTrackerBase.getPaddedNum(n,x)}:${TimeTrackerBase.getPaddedNum(d,U)}`}const d={name:a,type:"entries",entries:[{type:"list",items:e.data.l.items.map(e=>{const t=decodeURIComponent(e.h).split("_"),n=e.uid?Parser.numberToCr(+e.uid.split("_").last()):null,a=t[0].toTitleCase();return`${e.c||1}Ã— {@creature ${a}|${t[1]}${null==n?"":`|${a} (CR ${n})|${n}`}}`})}],data:{hoverTitle:a}};Renderer.hover.doHover(n,t[0],d,!0)}).click(async()=>{const t=this._parent.get("encounters")[e.id];e.countUses?(t.countUses=0,this._parent.triggerMapUpdate("encounters")):await TimeTrackerRoot_Calendar.pDoRunEncounter(this._parent,t)}).appendTo(M)})):(I.hide(),M.hide()))};this._parent.addHook("time",R),this._parent.addHook("offsetYears",R),this._parent.addHook("offsetMonthStartDay",R),this._parent.addHook("hoursPerDay",R),this._parent.addHook("minutesPerHour",R),this._parent.addHook("secondsPerMinute",R),this._parent.addHook("days",R),this._parent.addHook("months",R),this._parent.addHook("seasons",R),this._parent.addHook("events",R),this._parent.addHook("encounters",R),this._parent.addHook("moons",R),R();const b=$(`<button class="btn btn-xxs btn-default dm-time__btn-day"  title="Subtract Day (SHIFT for 5)">-</button>`).click(e=>d(-1*this._parent.get("hoursPerDay")*this._parent.get("minutesPerHour")*this._parent.get("secondsPerMinute")*(e.shiftKey?5:1),{isBase:!0})),N=$(`<button class="btn btn-xxs btn-default dm-time__btn-day" title="Add Day (SHIFT for 5)">+</button>`).click(e=>d(this._parent.get("hoursPerDay")*this._parent.get("minutesPerHour")*this._parent.get("secondsPerMinute")*(e.shiftKey?5:1),{isBase:!0})),U=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--top" title="Add Hour (SHIFT for 5, CTRL for 12)">+</button>`).click(e=>d(this._parent.get("minutesPerHour")*this._parent.get("secondsPerMinute")*(e.shiftKey?5:e.ctrlKey?12:1),{isBase:!0})),x=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--bottom" title="Subtract Hour (SHIFT for 5, CTRL for 12)">-</button>`).click(e=>d(-1*this._parent.get("minutesPerHour")*this._parent.get("secondsPerMinute")*(e.shiftKey?5:e.ctrlKey?12:1),{isBase:!0})),B=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--top" title="Add Minute (SHIFT for 5, CTRL for 15, Both for 30)">+</button>`).click(e=>d(this._parent.get("secondsPerMinute")*(e.shiftKey&&e.ctrlKey?30:e.ctrlKey?15:e.shiftKey?5:1),{isBase:!0})),W=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--bottom" title="Subtract Minute (SHIFT for 5, CTRL for 15, Both for 30)">-</button>`).click(e=>d(-1*this._parent.get("secondsPerMinute")*(e.shiftKey&&e.ctrlKey?30:e.ctrlKey?15:e.shiftKey?5:1),{isBase:!0})),F=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--top" title="Add Second (SHIFT for 5, CTRL for 15, Both for 30)">+</button>`).click(e=>d(e.shiftKey&&e.ctrlKey?30:e.ctrlKey?15:e.shiftKey?5:1,{isBase:!0})),L=$(`<button class="btn btn-xs btn-default dm-time__btn-time dm-time__btn-time--bottom" title="Subtract Second (SHIFT for 5, CTRL for 15, Both for 30)">-</button>`).click(e=>d(-1*(e.shiftKey&&e.ctrlKey?30:e.ctrlKey?15:e.shiftKey?5:1),{isBase:!0})),Y=$(`<button class="btn btn-default"><span class="glyphicon glyphicon-pause"></span></button>`).click(()=>this._parent.set("isPaused",!this._parent.get("isPaused"))),G=()=>Y.toggleClass("active",this._parent.get("isPaused")||this._parent.get("isAutoPaused"));this._parent.addHook("isPaused",G),this._parent.addHook("isAutoPaused",G),G();const K=$(`<button class="btn btn-xs btn-default mr-2" title="Add Long Rest (SHIFT for Subtract)">Long Rest</button>`).click(e=>d((e.shiftKey?-1:1)*this._parent.get("hoursPerLongRest")*this._parent.get("minutesPerHour")*this._parent.get("secondsPerMinute"),{isBase:!0})),X=$(`<button class="btn btn-xs btn-default mr-2" title="Add Short Rest (SHIFT for Subtract)">Short Rest</button>`).click(e=>d((e.shiftKey?-1:1)*this._parent.get("minutesPerShortRest")*this._parent.get("secondsPerMinute"),{isBase:!0})),q=$(`<button class="btn btn-xs btn-default" title="Add Round (6 seconds) (SHIFT for Subtract)">Add Round</button>`).click(e=>d((e.shiftKey?-1:1)*this._parent.get("secondsPerRound"),{isBase:!0})),z=$(`<div class="flex dm-time__wrp-weather">`);this._compWeather.render(z,this._parent),$$`<div class="flex h-100">
			<div class="flex-col flex-vh-center w-100">
				${r}
				${u}
				${p}
				<div class="flex flex-v-center relative">
					<div class="flex-col">
						<div class="flex-vh-center">${U}</div>
						${T}
						<div class="flex-vh-center">${x}</div>
					</div>
					<div class="dm-time__sep-time">:</div>
					<div class="flex-col">
						<div class="flex-vh-center">${B}</div>
						${D}
						<div class="flex-vh-center">${W}</div>
					</div>
					<div class="dm-time__sep-time">:</div>
					<div class="flex-col">
						<div class="flex-vh-center">${F}</div>
						${P}
						<div class="flex-vh-center">${L}</div>
					</div>
					<div class="flex-col ml-2">${Y}</div>
				</div>
				${c}
				<hr class="hr-3">
				<div class="flex-col">
					<div class="flex mb-2">
						${K}${X}${q}
					</div>
					<div class="flex">
						${_}
						${f}
					</div>
				</div>
			</div>
			
			<div class="dm-time__bar-clock"></div>
			
			<div class="flex-col no-shrink pr-1 flex-h-center">
				${y}
				<div class="small flex-vh-center btn-group">
					${b}${N}
				</div>
				<hr class="hr-2">

				${M}
				${I}

				${z}
			</div>
		</div>`.appendTo(e)}}class TimeTrackerRoot_Clock_Weather extends TimeTrackerComponent{render(e,t){e.empty(),this._parent=t;const{getTimeInfo:n}=t,a=$(`<button class="btn btn-xxs btn-default dm-time__btn-random-weather" title="Randomize Weather"><span class="fal fa-dice"/></button>`).click(async()=>{const e=await TimeTrackerRoot_Clock_RandomWeather.pGetUserInput({temperature:this._state.temperature,precipitation:this._state.precipitation,windDirection:this._state.windDirection,windSpeed:this._state.windSpeed},{unitsWindSpeed:this._parent.get("unitsWindSpeed")});null==e||Object.assign(this._state,e)}),d=$(`<button class="btn btn-default btn-sm dm-time__btn-weather mr-2"/>`).click(async()=>{let e=TimeTrackerRoot_Clock_Weather._TEMPERATURES.indexOf(this._state.temperature);~e||(e=2);const t=await InputUiUtil.pGetUserIcon({values:TimeTrackerRoot_Clock_Weather._TEMPERATURES.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._TEMPERATURE_META[t];return{name:e.uppercaseFirst(),buttonClass:n.class,iconClass:`fal ${n.icon}`}}),title:"Temperature",default:e});null!=t&&(this._state.temperature=TimeTrackerRoot_Clock_Weather._TEMPERATURES[t])}),s=()=>{TimeTrackerRoot_Clock_Weather._TEMPERATURE_META.forEach(e=>d.removeClass(e.class));let e=TimeTrackerRoot_Clock_Weather._TEMPERATURES.indexOf(this._state.temperature);~e||(e=0);const t=TimeTrackerRoot_Clock_Weather._TEMPERATURE_META[e];d.addClass(t.class),d.attr("title",this._state.temperature.uppercaseFirst()).html(`<div class="fal ${t.icon}"/>`)};this._addHookBase("temperature",s),s();const i=$(`<button class="btn btn-default btn-sm dm-time__btn-weather mr-2"/>`).click(async()=>{const{numHours:e,seasonInfos:t}=n({isBase:!0}),a=t.length&&!(e>=t[0].sunriseHour&&e<t[0].sunsetHour);let d=TimeTrackerRoot_Clock_Weather._PRECIPICATION.indexOf(this._state.precipitation);~d||(d=0);const s=await InputUiUtil.pGetUserIcon({values:TimeTrackerRoot_Clock_Weather._PRECIPICATION.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._PRECIPICATION_META[t];return{name:TimeTrackerUtil.revSlugToText(e),iconClass:`fal ${a&&n.iconNight?n.iconNight:n.icon}`,buttonClass:`btn-default`}}),title:"Weather",default:d});null!=s&&(this._state.precipitation=TimeTrackerRoot_Clock_Weather._PRECIPICATION[s])});let o=null;const r=e=>{const{numHours:t,seasonInfos:a}=n({isBase:!0}),d={numHours:t,seasonInfos:a};if("time"===e&&CollectionUtil.deepEquals(o,d))return;o=d;const s=a.length&&!(t>=a[0].sunriseHour&&t<a[0].sunsetHour);let r=TimeTrackerRoot_Clock_Weather._PRECIPICATION.indexOf(this._state.precipitation);~r||(r=0);const u=TimeTrackerRoot_Clock_Weather._PRECIPICATION_META[r];i.attr("title",TimeTrackerUtil.revSlugToText(this._state.precipitation)).html(`<div class="fal ${s&&u.iconNight?u.iconNight:u.icon}"/>`)};this._addHookBase("precipitation",r),this._parent.addHook("time",r),r();const u=$(`<button class="btn btn-default btn-sm dm-time__btn-weather"/>`).click(async()=>{const e=await TimeTrackerUtil.pGetUserWindBearing(this._state.windDirection);null!=e&&(this._state.windDirection=e)}),p=()=>{let e=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.indexOf(this._state.windSpeed);if(~e||(e=0),e){const t=5<=e?"fas":3<=e?"far":"fal";u.html(`<div class="${t} fa-arrow-up" style="transform: rotate(${this._state.windDirection}deg);"/>`)}else u.html(`<div class="fal fa-ellipsis-h"/>`)};this._addHookBase("windDirection",p),this._addHookBase("windSpeed",p),p();const c=$(`<button class="btn btn-default btn-xs"/>`).click(async()=>{let e=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.indexOf(this._state.windSpeed);~e||(e=0);const t=await InputUiUtil.pGetUserIcon({values:TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS_META[t];return{name:TimeTrackerUtil.revSlugToText(e),buttonClass:`btn-default`,iconContent:`<div class="mb-1 whitespace-normal dm-time__wind-speed">${"mph"===this._parent.get("unitsWindSpeed")?`${n.mph} mph`:`${n.kmph} km/h`}</div>`}}),title:"Wind Speed",default:e});null!=t&&(this._state.windSpeed=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[t])}),l=()=>{let e=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.indexOf(this._state.windSpeed);~e||(e=0);const t=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS_META[e];c.text(TimeTrackerUtil.revSlugToText(this._state.windSpeed)).attr("title","mph"===this._parent.get("unitsWindSpeed")?`${t.mph} mph`:`${t.kmph} km/h`)};this._addHookBase("windSpeed",l),this._parent.addHook("unitsWindSpeed",l),l();const _=$(`<div><span class="glyphicon glyphicon-info-sign"/></div>`),f=$$`<div class="mt-2">${_}</div>`,m=()=>{_.off("mouseover");const e=[],t=UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_TRAPS_HAZARDS];this._state.temperature===TimeTrackerRoot_Clock_Weather._TEMPERATURES[0]&&e.push(t({name:"Extreme Cold",source:SRC_DMG})),this._state.temperature===TimeTrackerRoot_Clock_Weather._TEMPERATURES.last()&&e.push(t({name:"Extreme Heat",source:SRC_DMG})),["rain-heavy","thunderstorm","snow"].includes(this._state.precipitation)&&e.push(t({name:"Heavy Precipitation",source:SRC_DMG})),3<=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.indexOf(this._state.windSpeed)&&e.push(t({name:"Strong Wind",source:SRC_DMG})),_.show(),1===e.length?_.mouseover(t=>Renderer.hover.mouseOver(t,_[0],UrlUtil.PG_TRAPS_HAZARDS,SRC_DMG,e[0],!1,null)):e.length?_.mouseover(async t=>{const n=await Renderer.hover.pCacheAndGet(UrlUtil.PG_TRAPS_HAZARDS,SRC_DMG,e[0]),a=await Promise.all(e.slice(1).map(e=>Renderer.hover.pCacheAndGet(UrlUtil.PG_TRAPS_HAZARDS,SRC_DMG,e))),d=[n,...a].map(e=>({type:"dataTrapHazard",dataTrapHazard:MiscUtil.copy(e)}));Renderer.hover.doHover(t,_[0],{type:"entries",entries:d,data:{hoverTitle:`Weather Effects`}})}):_.hide()};this._addHookBase("temperature",m),this._addHookBase("precipitation",m),this._addHookBase("windSpeed",m),m(),$$`<div class="flex-col w-100 flex-vh-center">
			<div class="flex-vh-center small mb-1"><span class="small-caps mr-2">Weather</span>${a}</div>
			<div class="mb-2">${d}${i}</div>
			
			<div class="flex-col flex-vh-center">
				<div class="small small-caps">Wind</div>
				<div class="mb-1">${u}</div> 
				<div>${c}</div>
			</div>
			
			${f} 
		</div>`.appendTo(e)}_getDefaultState(){return{...TimeTrackerRoot_Clock_Weather._DEFAULT_STATE}}}TimeTrackerRoot_Clock_Weather._TEMPERATURES=["freezing","cold","mild","hot","scorching"],TimeTrackerRoot_Clock_Weather._PRECIPICATION=["sunny","cloudy","foggy","rain-light","rain-heavy","thunderstorm","hail","snow"],TimeTrackerRoot_Clock_Weather._WIND_SPEEDS=["calm","breeze-light","breeze-moderate","breeze-strong","gale-near","gale","gale-severe","storm","hurricane"],TimeTrackerRoot_Clock_Weather._DEFAULT_STATE={temperature:TimeTrackerRoot_Clock_Weather._TEMPERATURES[2],precipitation:TimeTrackerRoot_Clock_Weather._PRECIPICATION[0],windDirection:0,windSpeed:TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[0]},TimeTrackerRoot_Clock_Weather._TEMPERATURE_META=[{icon:"fa-temperature-frigid",class:"btn-primary"},{icon:"fa-thermometer-quarter",class:"btn-info"},{icon:"fa-thermometer-half",class:"btn-default"},{icon:"fa-thermometer-three-quarters",class:"btn-warning"},{icon:"fa-temperature-hot",class:"btn-danger"}],TimeTrackerRoot_Clock_Weather._PRECIPICATION_META=[{icon:"fa-sun",iconNight:"fa-moon"},{icon:"fa-clouds-sun",iconNight:"fa-clouds-moon"},{icon:"fa-fog"},{icon:"fa-cloud-drizzle"},{icon:"fa-cloud-showers-heavy"},{icon:"fa-thunderstorm"},{icon:"fa-cloud-hail"},{icon:"fa-cloud-snow"}],TimeTrackerRoot_Clock_Weather._WIND_SPEEDS_META=[{mph:"<1",kmph:"<2"},{mph:"1-7",kmph:"2-11"},{mph:"8-18",kmph:"12-28"},{mph:"19-31",kmph:"29-49"},{mph:"32-38",kmph:"50-61"},{mph:"39-46",kmph:"62-74"},{mph:"47-54",kmph:"75-88"},{mph:"55-72",kmph:"89-117"},{mph:"\u226573",kmph:"\u2265118"}];class TimeTrackerRoot_Clock_RandomWeather extends BaseComponent{constructor(e){super(),this._unitsWindSpeed=e.unitsWindSpeed}render(e,t){e.empty();const n=TimeTrackerRoot_Clock_Weather._TEMPERATURES.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._TEMPERATURE_META[t];return{temperature:e,name:e.uppercaseFirst(),buttonClass:n.class,iconClass:`fal ${n.icon}`}}).map(e=>{const t=$$`<div class="m-2 btn ${e.buttonClass} ui-icn__btn flex-col flex-h-center">
						<div class="ui-icn__wrp-icon ${e.iconClass} mb-1"></div>
						<div class="whitespace-normal w-100">${e.name}</div>
					</div>`.click(()=>{this._state.allowedTemperatures=this._state.allowedTemperatures.includes(e.temperature)?this._state.allowedTemperatures.filter(t=>t!==e.temperature):[...this._state.allowedTemperatures,e.temperature]}),n=()=>t.toggleClass("active",this._state.allowedTemperatures.includes(e.temperature));return this._addHookBase("allowedTemperatures",n),n(),t}),a=TimeTrackerRoot_Clock_Weather._PRECIPICATION.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._PRECIPICATION_META[t];return{precipitation:e,name:TimeTrackerUtil.revSlugToText(e),iconClass:`fal ${n.icon}`}}).map(e=>{const t=$$`<div class="m-2 btn btn-default ui-icn__btn flex-col flex-h-center">
						<div class="ui-icn__wrp-icon ${e.iconClass} mb-1"></div>
						<div class="whitespace-normal w-100">${e.name}</div>
					</div>`.click(()=>{this._state.allowedPrecipitations=this._state.allowedPrecipitations.includes(e.precipitation)?this._state.allowedPrecipitations.filter(t=>t!==e.precipitation):[...this._state.allowedPrecipitations,e.precipitation]}),n=()=>t.toggleClass("active",this._state.allowedPrecipitations.includes(e.precipitation));return this._addHookBase("allowedPrecipitations",n),n(),t}),d=$(`<button class="btn btn-default btn-sm dm-time__btn-weather"/>`).click(async()=>{const e=await TimeTrackerUtil.pGetUserWindBearing(this._state.prevailingWindDirection);null!=e&&(this._state.prevailingWindDirection=e)}),s=()=>{d.html(`<div class="far fa-arrow-up" style="transform: rotate(${this._state.prevailingWindDirection}deg);"/>`)};this._addHookBase("prevailingWindDirection",s),s();const i=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.map((e,t)=>{const n=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS_META[t];return{speed:e,name:TimeTrackerUtil.revSlugToText(e),iconContent:`<div class="mb-1 whitespace-normal dm-time__wind-speed">${"mph"===this._unitsWindSpeed?`${n.mph} mph`:`${n.kmph} km/h`}</div>`}}).map(e=>{const t=$$`<div class="m-2 btn btn-default ui-icn__btn flex-col flex-h-center">
						${e.iconContent}
						<div class="whitespace-normal w-100">${e.name}</div>
					</div>`.click(()=>{this._state.allowedWindSpeeds=this._state.allowedWindSpeeds.includes(e.speed)?this._state.allowedWindSpeeds.filter(t=>t!==e.speed):[...this._state.allowedWindSpeeds,e.speed]}),n=()=>t.toggleClass("active",this._state.allowedWindSpeeds.includes(e.speed));return this._addHookBase("allowedWindSpeeds",n),n(),t}),o=$(`<button class="btn btn-default">Confirm</button>`).click(()=>{this._state.allowedTemperatures.length&&this._state.allowedPrecipitations.length&&this._state.allowedWindSpeeds.length?t(!0):JqueryUtil.doToast({content:`Please select allowed values for all sections!`,type:"warning"})});$$`<div class="flex-col w-100 h-100">
			<div class="flex-col">
				<h5>Allowed Temperatures</h5>
				<div class="flex">${n}</div>
			</div>
			<div class="flex-col">
				<h5>Allowed Precipitation Types</h5>
				<div class="flex">${a}</div>
			</div>
			<div class="flex-v-center mt-2">
				<h5 class="mr-2">Prevailing Wind Direction</h5>${d}
			</div>
			<div class="flex-col">
				<h5>Allowed Wind Speeds</h5>
				<div class="flex">${i}</div>
			</div>
			<div class="flex-vh-center">${o}</div>
		</div>`.appendTo(e)}_getDefaultState(){return{...TimeTrackerRoot_Clock_RandomWeather._DEFAULT_STATE}}static async pGetUserInput(e,t){t=t||{};const n=new TimeTrackerRoot_Clock_RandomWeather(t),a=await StorageUtil.pGetForPage(TimeTrackerRoot_Clock_RandomWeather._STORAGE_KEY);return a&&n.setStateFrom(a),new Promise(t=>{const{$modalInner:a,doClose:d}=UiUtil.getShowModal({title:"Random Weather Configuration",isLarge:!0,cbClose:a=>{a||t(null),StorageUtil.pSetForPage(TimeTrackerRoot_Clock_RandomWeather._STORAGE_KEY,n.getSaveableState());const d=n.toObject(),s=1<RollerUtil.randomise(3),i=1<RollerUtil.randomise(5),o=RollerUtil.randomise(5);let r;r=1===o?e.windDirection:3>=o?d.prevailingWindDirection:RollerUtil.randomise(360)-1,r+=TimeTrackerRoot_Clock_RandomWeather._getBearingFudge();const u=RollerUtil.randomise(7);let p;const c=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.indexOf(e.windSpeed);let l=0;if(3>=u?l=-u:5<=u&&(l=u-4),0>l){p=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[c+l];for(let e=-1;!d.allowedWindSpeeds.includes(p);)p=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[c+l+e],0>--e&&(p=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.find(e=>d.allowedWindSpeeds.includes(e)))}else if(0<l){p=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[c+l];for(let e=1;!d.allowedWindSpeeds.includes(p);)p=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS[c+l+e],++e>=TimeTrackerRoot_Clock_Weather._WIND_SPEEDS.length&&(p=[...TimeTrackerRoot_Clock_Weather._WIND_SPEEDS].reverse().find(e=>d.allowedWindSpeeds.includes(e)))}else p=e.windSpeed;t({temperature:s?RollerUtil.rollOnArray(d.allowedTemperatures):e.temperature,precipitation:i?RollerUtil.rollOnArray(d.allowedPrecipitations):e.precipitation,windDirection:r,windSpeed:p})}});n.render(a,d)})}static _getBearingFudge(){return Math.round(RollerUtil.randomise(20,0))*(2===RollerUtil.randomise(2)?1:-1)}}TimeTrackerRoot_Clock_RandomWeather._DEFAULT_STATE={allowedTemperatures:[...TimeTrackerRoot_Clock_Weather._TEMPERATURES],allowedPrecipitations:[...TimeTrackerRoot_Clock_Weather._PRECIPICATION],prevailingWindDirection:0,allowedWindSpeeds:[...TimeTrackerRoot_Clock_Weather._WIND_SPEEDS]},TimeTrackerRoot_Clock_RandomWeather._STORAGE_KEY="TimeTracker_RandomWeatherModal";class TimeTrackerRoot_Calendar extends TimeTrackerComponent{constructor(e,t){super(e,t),this._tmpComps=[]}render(e,t){e.empty(),this._parent=t;const{getTimeInfo:n,doModTime:a}=t;let d=null;const s=$(`<div class="small-caps"/>`),i=$(`<div class="small-caps text-muted small"/>`),{$wrpDateControls:o,$iptYear:r,$iptMonth:u,$iptDay:p}=TimeTrackerRoot_Calendar.getDateControls(this._parent),c=ComponentUiUtil.$getBtnBool(this._parent.component,"isBrowseMode",{$ele:$(`<button class="btn btn-xs btn-default">Browse</button>`),fnHookPost:e=>{e?this._parent.set("browseTime",this._parent.get("time")):this._parent.set("browseTime",null)}}),l=$(`<div class="overflow-y-auto smooth-scroll"/>`),_=e=>{const t=n(),{date:a,month:o,year:c,monthInfo:_,monthStartDay:f,daysPerWeek:m,dayInfo:g,monthStartDayOfYear:h,seasonInfos:S,numDays:E,yearInfos:y,eraInfos:T,secsPerDay:D}=t,P={date:a,month:o,year:c,monthInfo:_,monthStartDay:f,daysPerWeek:m,dayInfo:g,monthStartDayOfYear:h,seasonInfos:S,numDays:E,yearInfos:y,eraInfos:T,secsPerDay:D};"time"===e&&CollectionUtil.deepEquals(d,P)||(d=P,s.text(TimeTrackerBase.formatDateInfo(g,a,_,S)),i.html(TimeTrackerBase.formatYearInfo(c,y,T)),r.val(c+1),u.val(o+1),p.val(a+1),TimeTrackerRoot_Calendar.renderCalendar(this._parent,l,t,(e,t,n,a)=>{e.shiftKey?this._render_doJumpToDay(t,n):this._render_openDayModal(t,n,a)},{hasColumnLabels:this._parent.get("hasCalendarLabelsColumns"),hasRowLabels:this._parent.get("hasCalendarLabelsRows")}))};this._parent.addHook("time",_),this._parent.addHook("browseTime",_),this._parent.addHook("hasCalendarLabelsColumns",_),this._parent.addHook("hasCalendarLabelsRows",_),this._parent.addHook("months",_),this._parent.addHook("events",_),this._parent.addHook("encounters",_),this._parent.addHook("moons",_),_(),$$`<div class="flex-col h-100 flex-h-center">
			${s}
			<div class="split mb-2 flex-v-top">
				${i}
				${c}
			</div>
			${o}
			<hr class="hr-2 no-shrink">
			${l}
		</div>`.appendTo(e)}static getDateControls(e,t){var n=Math.min,a=Math.max;t=t||{};const{doModTime:d,getTimeInfo:s}=e,i=t.isHideDays?null:$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust"  title="Subtract Day (SHIFT for 5)">-D</button>`).click(e=>d(-1*s().secsPerDay*(e.shiftKey?5:1))),o=t.isHideDays?null:$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust" title="Add Day (SHIFT for 5)">D+</button>`).click(e=>d(s().secsPerDay*(e.shiftKey?5:1))),r=t.isHideWeeks?null:$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust"  title="Subtract Week (SHIFT for 5)">-W</button>`).click(e=>d(-1*s().secsPerWeek*(e.shiftKey?5:1))),u=t.isHideWeeks?null:$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust" title="Add Week (SHIFT for 5)">W+</button>`).click(e=>d(s().secsPerWeek*(e.shiftKey?5:1))),p=e=>{const t=()=>{const{secsPerDay:e,monthInfo:t,nextMonthInfo:n,date:a}=s(),i=a>n.days?n.days-1:a,o=t.days-a+i;d(o*e)},n=()=>{const{secsPerDay:e,prevMonthInfo:t,date:n}=s(),a=n>t.days?t.days-1:n,i=-n-(t.days-a);d(i*e)};if(1===e)t();else if(-1===e)n();else{if(0===e)return;const a=s();1<e?[...Array(e)].forEach(()=>t()):[...Array(Math.abs(e))].forEach(()=>n());const i=s();if(a.date!==i.date&&a.date<i.monthInfo.days){const e=a.date-i.date;d(e*i.secsPerDay)}}},c=$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust"  title="Subtract Month (SHIFT for 5)">-M</button>`).click(e=>p(e.shiftKey?-5:-1)),l=$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust" title="Add Month (SHIFT for 5)">M+</button>`).click(e=>p(e.shiftKey?5:1)),_=$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust"  title="Subtract Year (SHIFT for 5)">-Y</button>`).click(e=>d(-1*s().secsPerYear*(e.shiftKey?5:1))),f=$(`<button class="btn btn-xs btn-default dm-time__btn-date-adjust" title="Add Year (SHIFT for 5)">Y+</button>`).click(e=>d(s().secsPerYear*(e.shiftKey?5:1))),m=$(`<input class="form-control form-control--minimal text-center input-xs dm-time__calendar-ipt-date dm-time__calendar-ipt-date--slashed-right" title="Year">`).change(()=>{const{secsPerYear:e,year:t}=s(),n=UiUtil.strToInt(m.val(),1)-1;m.val(n+1);d((n-t)*e)}),g=$(`<input class="form-control form-control--minimal text-center input-xs dm-time__calendar-ipt-date dm-time__calendar-ipt-date--slashed-left ${t.isHideDays?"":"dm-time__calendar-ipt-date--slashed-right"}" title="Month">`).change(()=>{const{month:e,monthsPerYear:t}=s(),d=UiUtil.strToInt(g.val(),1)-1,i=a(0,n(t-1,d));g.val(i+1);p(i-e)}),h=t.isHideDays?null:$(`<input class="form-control form-control--minimal text-center input-xs dm-time__calendar-ipt-date dm-time__calendar-ipt-date--slashed-left" title="Day">`).change(()=>{const{secsPerDay:e,date:t,monthInfo:i}=s(),o=UiUtil.strToInt(h.val(),1)-1,r=a(0,n(i.days-1,o));h.val(r+1);d((r-t)*e)}),S=$$`<div class="flex flex-vh-center">
			<div class="flex btn-group mr-2">
				${_}
				${c}
				${r} 
				${i} 
			</div>
			<div class="mr-2 flex-v-center">
				${m}
				<div class="no-shrink dm-time__calendar-date-sep">/</div>
				${g}
				${h?`<div class="no-shrink dm-time__calendar-date-sep">/</div>`:""}
				${h}
			</div>
			<div class="flex-h-right btn-group">
				${o} 
				${u} 
				${l}
				${f} 
			</div>
		</div>`;return{$wrpDateControls:S,$iptYear:m,$iptMonth:g,$iptDay:h}}static renderCalendar(e,t,n,a,d){var s=Math.floor;d=d||{};const{getEvents:o,getEncounters:r,getMoonInfos:u}=e,{date:p,year:c,monthInfo:l,monthStartDay:_,daysPerWeek:f,monthStartDayOfYear:m,numDays:g}=n;t.empty().css({display:"grid"});const h=d.hasRowLabels?1:0,S=d.hasColumnLabels?1:0;if(d.hasColumnLabels){const n=e.getAllDayInfos();n.forEach((e,n)=>{$(`<div class="small text-muted small-caps text-center" title="${e.name.escapeQuotes()}">${e.name.slice(0,2)}</div>`).css({"grid-column-start":`${n+h+1}`,"grid-column-end":`${n+h+2}`,"grid-row-start":`1`,"grid-row-end":`2`}).appendTo(t)})}const E=l.days;for(let l=-_;l<E+(f-1-_);++l){const e=s((l+_)%f),n=s((l+_)/f);if(0===e&&d.hasRowLabels&&l<E){const a=s(m/f)+n;$(`<div class="small text-muted small-caps flex-vh-center" title="Week ${a}">${a}</div>`).css({"grid-column-start":`${e+1}`,"grid-column-end":`${e+2}`,"grid-row-start":`${n+S+1}`,"grid-row-end":`${n+S+2}`}).appendTo(t)}let i;if(0>l||l>=E)i=$(`<div class="m-1"/>`);else{const e=m+l,t=g-(p-l),n=u(t),s=o(c,e),_=r(c,e),f=n.filter(e=>e.phaseFirstDay);let h;if(f.length){const e=f.map((e,t)=>{if(0===t||3>f.length)return TimeTrackerBase.$getCvsMoon(e).addClass("dm-time__calendar-moon-phase");if(1===t){const e=f.length-1;return`<div class="dm-time__calendar-moon-phase text-muted" title="${e} additional moon${1==e?"":"s"} not shown"><span class="glyphicon glyphicon-plus"/></div>`}});h=$$`<div class="dm-time__disp-day-moon flex-col">${e}</div>`}else h="";i=$$`<div class="dm-time__disp-calendar-day btn-xxs m-1 relative ${l!==p||d.isHideDay?"":"dm-time__disp-calendar-day--active"}">
					${l+1}
					${s.length?`<div class="dm-time__disp-day-entry dm-time__disp-day-entry--event" title="Has Events">*</div>`:""}
					${_.length?`<div class="dm-time__disp-day-entry dm-time__disp-day-entry--encounter" title="Has Encounters">*</div>`:""} 
					${h}
				</div>`.click(n=>a(n,c,e,t))}i.css({"grid-column-start":`${e+h+1}`,"grid-column-end":`${e+h+2}`,"grid-row-start":`${n+S+1}`,"grid-row-end":`${n+S+2}`}),t.append(i)}}_render_doJumpToDay(e,t){const{getTimeInfo:n,doModTime:a}=this._parent,{year:d,dayOfYear:s,secsPerYear:i,secsPerDay:o}=n({isBase:!0});a(e*i+t*o-(d*i+s*o),{isBase:!0}),this._parent.set("isBrowseMode",!1)}_render_openDayModal(e,t,n){const{getTimeInfo:a,getEvents:d,getEncounters:s,getMoonInfos:i}=this._parent,o=$(`<button class="btn btn-xs btn-default" title="Set the current date to this day. This will end Browse Mode, if it is currently active.">Go to Day</button>`).click(()=>{this._render_doJumpToDay(e,t),P()}),r=$(`<button class="btn btn-xs btn-primary"><span class="glyphicon glyphicon-plus"/> Add Event</button>`).click(()=>{const e=Object.keys(this._parent.get("events")).length,n=TimeTrackerBase.getGenericEvent(e,p,t);this._eventToEdit=n.id,this._parent.set("events",{...this._parent.get("events"),[n.id]:n})}),u=$(`<button class="btn btn-xs btn-primary" title="SHIFT to Add at Current Time">At Time...</button>`).click(async n=>{const a=await this._render_pGetEventTimeOfDay(e,t,n.shiftKey);if(null==a)return;const d=Object.keys(this._parent.get("events")).length,s=TimeTrackerBase.getGenericEvent(d,a.year,a.eventDay,a.timeOfDay);this._eventToEdit=s.id,this._parent.set("events",{...this._parent.get("events"),[s.id]:s})}),{year:p,dayInfo:c,date:l,monthInfo:_,seasonInfos:f,yearInfos:m,eraInfos:g}=a({year:e,dayOfYear:t}),h=async(e,t,n,a,d)=>{switch(+a.data("ctx-id")){case 0:{const e=await EncounterUtil.pGetInitialState();if(e&&e.data){const t=e.data,n=await InputUiUtil.pGetUserString({title:"Enter Encounter Name",default:EncounterUtil.getEncounterName(t)});d.name=n||"(Unnamed encounter)",d.data=t}else return JqueryUtil.doToast({content:`No saved encounter! Please first go to the Bestiary and create one.`,type:"warning"});break}case 1:{const e=(await EncounterUtil.pGetSavedState()).savedEncounters||{},t=Object.keys(e);if(!t.length)return JqueryUtil.doToast({type:"warning",content:"No saved encounters were found! Go to the Bestiary and create some first."});const n=$(`<input type="checkbox">`);n.prop("checked",TimeTrackerRoot_Calendar._tmpPrefCbCopy);const a=await InputUiUtil.pGetUserEnum({values:t.map(t=>e[t].name||EncounterUtil.getEncounterName(e[t])),placeholder:"Select an encounter",title:"Select Saved Encounter",fnGetExtraState:()=>({isCopy:n.prop("checked")}),$elePost:$$`<label class="flex-label flex-h-center w-100 mb-2">
								<span class="mr-2 help" title="Turning this on will make a copy of the encounter as it currently exists, allowing the original to be modified or deleted without affecting the copy. Leaving this off will instead keep a reference to the encounter, so any change to the encounter will be reflected here.">Make Copy of Encounter</span>
								${n}
							</label>`});if(null!=a){const n=t[a.ix],s=e[n];d.name=s.name,TimeTrackerRoot_Calendar._tmpPrefCbCopy=a.extraState.isCopy,d.data=a.extraState.isCopy?s.data:{isRef:!0,bestiaryId:n}}else return;break}case 2:{const e=await DataUtil.pUserUpload();if(e){const t=await InputUiUtil.pGetUserString({title:"Enter Encounter Name",default:EncounterUtil.getEncounterName(e)});d.name=t||"(Unnamed Encounter)",d.data=e}else return;break}}this._parent.set("encounters",[...Object.values(this._parent.get("encounters")),d].map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{}))},S=ContextUtil.getNextGenericMenuId();ContextUtil.doInitContextMenu(S,(e,n,a,d)=>{const s=Object.keys(this._parent.get("encounters")).length,i=TimeTrackerBase.getGenericEncounter(s,p,t);return h(e,n,a,d,i)},["From Current Bestiary Encounter","From Saved Bestiary Encounter","From Bestiary Encounter File"]);const E=ContextUtil.getNextGenericMenuId();ContextUtil.doInitContextMenu(E,async(n,a,d,s)=>{const i=await this._render_pGetEventTimeOfDay(e,t,n.shiftKey);if(null==i)return;const o=Object.keys(this._parent.get("encounters")).length,r=TimeTrackerBase.getGenericEncounter(o,i.year,i.eventDay,i.timeOfDay);return h(n,a,d,s,r)},[{text:"From Current Bestiary Encounter",title:"SHIFT to Add at Current Time"},{text:"From Saved Bestiary Encounter",title:"SHIFT to Add at Current Time"},{text:"From Bestiary Encounter File",title:"SHIFT to Add at Current Time"}]);const y=$(`<button class="btn btn-xs btn-success"><span class="glyphicon glyphicon-plus"/> Add Encounter</button>`).click(e=>ContextUtil.handleOpenContextMenu(e,y,S)),T=$(`<button class="btn btn-xs btn-success">At Time...</button>`).click(e=>ContextUtil.handleOpenContextMenu(e,T,E)),{$modalInner:D,doClose:P}=UiUtil.getShowModal({title:`${TimeTrackerBase.formatDateInfo(c,l,_,f)}\u2014${TimeTrackerBase.formatYearInfo(p,m,g)}`,cbClose:()=>{this._parent.removeHook("events",H),ContextUtil.doTeardownContextMenu(S)},zIndex:TimeTrackerRoot_Calendar._Z_INDEX_MODAL,isLarge:!0,fullHeight:!0,titleSplit:o}),M=$(`<hr class="hr-2 no-shrink">`),I=$(`<div class="flex flex-wrap w-100 no-shrink flex-v-center"/>`),k=()=>{const e=i(n);I.empty(),e.forEach(e=>{$$`<div class="flex-v-center mr-2">
					${TimeTrackerBase.$getCvsMoon(e).addClass("mr-2")} 
					<div class="flex-col">
						<div class="flex">${e.name}</div>
						<div class="flex small"><i class="mr-1">${e.phaseName}</i><span class="text-muted">(Day ${e.dayOfPeriod+1}/${e.period})</span></div>				
					</div>
				</div>`.appendTo(I)}),M.toggle(!!e.length)};this._parent.addHook("moons",k),k();const C=$(`<div class="flex-col w-100 overflow-y-auto dm-time__day-entry-wrapper"/>`),H=()=>{const e=d(p,t);C.empty(),this._tmpComps=[];const n=this._render_openDayModal_openCalendarPicker.bind(this);if(e.forEach(e=>{const t=TimeTrackerRoot_Settings_Event.getInstance(this._board,this._$wrpPanel,this._parent,e);this._tmpComps.push(t),t.render(C,this._parent,n)}),e.length||C.append(`<div class="flex-vh-center italic">(No events)</div>`),this._eventToEdit){const e=this._tmpComps.find(e=>e._state.id===this._eventToEdit);this._eventToEdit=null,e&&e.doOpenEditModal()}};this._parent.addHook("events",H),H();const A=$(`<div class="flex-col w-100 overflow-y-auto dm-time__day-entry-wrapper"/>`),v=async()=>{await this._pLock("encounters");const e=s(p,t);A.empty(),await Promise.all(e.map(async e=>{const t=await TimeTrackerRoot_Calendar._pGetDereferencedEncounter(e);null!=t&&(e.name=t.name)})),e.forEach(e=>{const t=$(`<input class="form-control input-xs form-control--minimal mr-2 w-100 ${0<e.countUses?"text-muted":""}">`).change(()=>{e.displayName=t.val().trim(),this._parent.triggerMapUpdate("encounters")}).val(null==e.displayName?e.name:e.displayName),n=$(`<button class="btn btn-xs btn-default mr-2 ${0<e.countUses?"disabled":""}" title="${0<e.countUses?"(Encounter has been used)":"Run Encounter (Add to Initiative Tracker)"}"><span class="glyphicon glyphicon-play"/></button>`).click(()=>TimeTrackerRoot_Calendar.pDoRunEncounter(this._parent,e)),d=$(`<button class="btn btn-xs btn-default mr-2 ${0===e.countUses?"disabled":""}" title="Reset Usage"><span class="glyphicon glyphicon-refresh"/></button>`).click(()=>{0===e.countUses||(e.countUses=0,this._parent.triggerMapUpdate("encounters"))}),s=$(`<button class="btn btn-xs btn-default mr-3" title="Download Encounter File"><span class="glyphicon glyphicon-download"/></button>`).click(async()=>{const t=await TimeTrackerRoot_Calendar._pGetDereferencedEncounter(e);return t?void DataUtil.userDownload("encounter",t.data):JqueryUtil.doToast({content:"Could not find encounter data! Has the encounter been deleted?",type:"warning"})}),i=$(`<input type="checkbox">`).prop("checked",e.hasTime).change(()=>{const t=i.prop("checked");if(t){const{secsPerDay:t}=a({isBase:!0});null==e.timeOfDaySecs&&(e.timeOfDaySecs=Math.floor(t/2)),e.hasTime=!0}else e.hasTime=!1;this._parent.triggerMapUpdate("encounters")});let o;if(e.hasTime){const t=a({isBase:!0}),n={hours:0,minutes:0,seconds:0,timeOfDaySecs:e.timeOfDaySecs};null!=e.timeOfDaySecs&&Object.assign(n,TimeTrackerBase.getHoursMinutesSecondsFromSeconds(t.secsPerHour,t.secsPerMinute,e.timeOfDaySecs)),o=TimeTrackerBase.getClockInputs(t,n,t=>{e.timeOfDaySecs=t,this._parent.triggerMapUpdate("encounters")})}const r=$(`<button class="btn btn-xs btn-default mr-2 no-shrink"><span class="glyphicon glyphicon-move" title="Move Encounter"/></button>`).click(()=>{this._render_openDayModal_openCalendarPicker({title:"Choose Encounter Day",fnClick:(t,n,a)=>{e.when={day:a,year:n},this._parent.triggerMapUpdate("encounters")},prop:"encounters"})}),u=$(`<button class="btn btn-xs btn-danger" title="Delete Encounter"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>{e.isDeleted=!0,this._parent.triggerMapUpdate("encounters")});$$`<div class="flex-v-center w-100 py-1 px-2 stripe-even">
					${t}
					${n} 
					${d}
					${s} 
					<label class="flex-v-center ${o?"mr-2":"mr-3"}"> 
						<div class="mr-1 no-wrap">Has Time?</div>
						${i} 
					</label> 
					${o?$$`<div class="flex-v-center mr-3">
						${o.$iptHours}
						<div>:</div>
						${o.$iptMinutes}
						<div>:</div>
						${o.$iptSeconds}
					</div>`:""}
					${r}
					${u}
				</div>`.appendTo(A)}),e.length||A.append(`<div class="flex-vh-center italic">(No encounters)</div>`),this._unlock("encounters")};this._parent.addHook("encounters",v),v(),$$`<div class="flex-col w-100 h-100 px-2">
			${I}
			${M}
			<div class="split flex-v-center mb-1 no-shrink">
				<div class="underline dm-time__day-entry-header">Events</div>
				<div class="btn-group flex">${r}${u}</div>	
			</div>
			${C}
			<hr class="hr-2 no-shrink">
			<div class="split flex-v-center mb-1 no-shrink">
				<div class="underline dm-time__day-entry-header">Encounters</div>
				<div class="btn-group flex">${y}${T}</div>
			</div>
			${A}
		</div>`.appendTo(D)}_render_getUserEventTime(){const{getTimeInfo:e}=this._parent,{hoursPerDay:t,minutesPerHour:n,secsPerMinute:a,secsPerHour:d}=e(),s=`${t}`.length,i=`${n}`.length,o=`${a}`.length;return new Promise(e=>{class r extends BaseComponent{render(e){const d=ComponentUiUtil.$getSelEnum(this,"mode",{values:["Exact Time","Time from Now"]}).addClass("mb-2"),r=ComponentUiUtil.$getIptInt(this,"exactHour",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center mr-1">`),padLength:s,min:0,max:t-1}),u=ComponentUiUtil.$getIptInt(this,"exactMinute",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center mr-1">`),padLength:i,min:0,max:n-1}),p=ComponentUiUtil.$getIptInt(this,"exactSec",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center">`),padLength:o,min:0,max:a-1}),l=$$`<div class="flex-vh-center">
						${r} 
						<div class="mr-1">:</div>
						${u} 
						<div class="mr-1">:</div>
						${p}
					</div>`,_=ComponentUiUtil.$getIptInt(this,"offsetHour",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center mr-1">`),min:-TimeTrackerBase._MAX_TIME,max:TimeTrackerBase._MAX_TIME}),f=ComponentUiUtil.$getIptInt(this,"offsetMinute",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center mr-1">`),min:-TimeTrackerBase._MAX_TIME,max:TimeTrackerBase._MAX_TIME}),m=ComponentUiUtil.$getIptInt(this,"offsetSec",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-center mr-1">`),min:-TimeTrackerBase._MAX_TIME,max:TimeTrackerBase._MAX_TIME}),g=$$`<div class="flex-vh-center">
						${_}
						<div class="mr-2 no-wrap">hours,</div>
						${f}
						<div class="mr-2 no-wrap">minutes, and</div>
						${m}
						<div class="mr-2 no-wrap">seconds from now</div>
					</div>`,h=()=>{l.toggleClass("hidden","Exact Time"!==this._state.mode),g.toggleClass("hidden","Exact Time"===this._state.mode)};this._addHookBase("mode",h),h();const S=$(`<button class="btn btn-default">Enter</button>`).click(()=>c(!0));$$`<div class="flex-col h-100">
						<div class="flex-vh-center flex-col w-100 h-100">
							${d} 
							${l} 
							${g}
						</div>
						${S}
					</div>`.appendTo(e)}_getDefaultState(){return{mode:"Exact Time",exactHour:0,exactMinute:0,exactSec:0,offsetHour:0,offsetMinute:0,offsetSec:0}}}const u=new r,{$modalInner:p,doClose:c}=UiUtil.getShowModal({title:"Enter a Time",cbClose:t=>{if(!t)return e(null);const n=u.toObject();"Exact Time"===n.mode?e({mode:"timeExact",timeOfDaySecs:n.exactHour*d+n.exactMinute*a+n.exactSec}):e({mode:"timeOffset",secsOffset:n.offsetHour*d+n.offsetMinute*a+n.offsetSec})}});u.render(p)})}async _render_pGetEventTimeOfDay(e,t,n){var a=Math.abs,d=Math.max;const{getTimeInfo:s}=this._parent;let i=null;if(n){const{timeOfDaySecs:e}=s();i=e}else{const n=await this._render_getUserEventTime();if(null==n)return null;if("timeExact"===n.mode)i=n.timeOfDaySecs;else{const{timeOfDaySecs:o,secsPerYear:r,secsPerDay:u}=s();for(;a(n.secsOffset)>=r;)0>n.secsOffset?(n.secsOffset+=r,e-=1):(n.secsOffset-=r,e+=1);for(e=d(0,e);a(n.secsOffset)>=u||0>n.secsOffset;)0>n.secsOffset?(n.secsOffset+=u,t-=1):(n.secsOffset-=u,t+=1);t=d(0,t),i=o+n.secsOffset}}return{eventYear:e,eventDay:t,timeOfDay:i}}_render_openDayModal_openCalendarPicker(e){e=e||{};const{$modalInner:t,doClose:n}=UiUtil.getShowModal({title:e.title,zIndex:TimeTrackerRoot_Calendar._Z_INDEX_MODAL}),a=new TimeTrackerBase(null,null,{isTemporary:!0});Object.assign(a.__state,this._parent.component.__state);const d=a.getPod(),{$wrpDateControls:s,$iptYear:i,$iptMonth:o}=TimeTrackerRoot_Calendar.getDateControls(d,{isHideWeeks:!0,isHideDays:!0});s.addClass("mb-2").appendTo(t);const r=$(`<div/>`).appendTo(t),u=()=>{const t=d.getTimeInfo();TimeTrackerRoot_Calendar.renderCalendar(d,r,t,(t,a,d)=>{e.fnClick(t,a,d),n()},{isHideDay:!0,hasColumnLabels:this._parent.get("hasCalendarLabelsColumns"),hasRowLabels:this._parent.get("hasCalendarLabelsRows")}),i.val(t.year+1),o.val(t.month+1)};d.addHook("time",u),d.addHook(e.prop,u),u();const p=()=>this._parent.set(e.prop,d.get(e.prop));d.addHook(e.prop,p)}static async _pGetDereferencedEncounter(e){if(e.data.isRef){const t=await EncounterUtil.pGetSavedState();return(t.savedEncounters||{})[e.data.bestiaryId]}return e}static async pDoRunEncounter(e,t){if(!(0<t.countUses)){const n=e.component._board.getPanelsByType(PANEL_TYP_INITIATIVE_TRACKER).map(e=>e.tabDatas.filter(e=>e.type===PANEL_TYP_INITIATIVE_TRACKER).map(e=>e.$content.find(`.dm__data-anchor`))).flat();if(n.length){let a;if(1===n.length)a=n[0];else{const e=await InputUiUtil.pGetUserEnum({default:0,title:"Choose a Tracker",placeholder:"Select tracker"});null!=e&&~e&&(a=n[e])}if(a){const n=await TimeTrackerRoot_Calendar._pGetDereferencedEncounter(t);if(!n)return JqueryUtil.doToast({content:"Could not find encounter data! Has the encounter been deleted?",type:"warning"});try{await a.data("doConvertAndLoadBestiaryList")(n.data)}catch(t){throw JqueryUtil.doToast({type:"error",content:`Failed to add encounter! ${MiscUtil.STR_SEE_CONSOLE}`}),t}JqueryUtil.doToast({type:"success",content:"Encounter added to Initiative Tracker."}),t.countUses+=1,e.triggerMapUpdate("encounters")}}else t.countUses+=1,e.triggerMapUpdate("encounters")}}}TimeTrackerRoot_Calendar._Z_INDEX_MODAL=200,TimeTrackerRoot_Calendar._tmpPrefCbCopy=!1;class TimeTrackerRoot_Settings extends TimeTrackerComponent{static getTimeNum(e,t){var n=Math.min,a=Math.max,d=Math.round;const s=+e.trim();return isNaN(s)?TimeTrackerBase._MIN_TIME:a(n(d(s),TimeTrackerBase._MAX_TIME),t?-TimeTrackerBase._MAX_TIME:TimeTrackerBase._MIN_TIME)}constructor(e,t){super(e,t),this._tmpComps={}}render(e,t){e.empty(),this._parent=t;const n=(e,t)=>{t=t||{};const n=$(`<input class="form-control input-xs form-control--minimal w-30 no-shrink text-right">`).change(()=>this._parent.set(e,TimeTrackerRoot_Settings.getTimeNum(n.val(),t.isAllowNegative))),a=()=>n.val(this._parent.get(e));return this._parent.addHook(e,a),a(),n},a=[],d=(e,t,...n)=>{const d=$(`<button class="btn btn-xs btn-default" title="Hide Section"><span class="glyphicon glyphicon-eye-close"/></button>`).click(()=>this._parent.set(e,!this._parent.get(e))),s=()=>{const a=this._parent.get(e);t.toggleClass("hidden",a),d.toggleClass("active",a),n&&n.forEach(e=>e.toggleClass("hidden",a))};return this._parent.addHook(e,s),a.push(s),d},s=(...e)=>$(`<button class="btn btn-xs btn-default mr-2">Reset Section</button>`).click(()=>{confirm("Are you sure?")&&e.forEach(e=>this._parent.set(e,TimeTrackerBase._DEFAULT_STATE[e]))}),i=$(`<select class="form-control input-xs">
				<option value="mph">Miles per Hour</option>
				<option value="kmph">Kilometres per Hour</option>
			</select>`).change(()=>this._parent.set("unitsWindSpeed",i.val())),o=()=>i.val(this._parent.get("unitsWindSpeed"));this._parent.addHook("unitsWindSpeed",o),o();const r=this._render_getChildMeta("days",TimeTrackerRoot_Settings_Day,"Day",TimeTrackerRoot.getGenericDay),u=this._render_getChildMeta("months",TimeTrackerRoot_Settings_Month,"Month",TimeTrackerRoot.getGenericMonth),p=this._render_getChildMeta("seasons",TimeTrackerRoot_Settings_Season,"Season",TimeTrackerRoot.getGenericSeason,{fnSort:(e,t)=>SortUtil.ascSort(e.startDay,t.startDay),isEmptyMessage:`<div class="flex-vh-center my-1 italic w-100">(No seasons)</div>`}),c=this._render_getChildMeta("years",TimeTrackerRoot_Settings_Year,"Year",TimeTrackerRoot.getGenericYear,{fnSort:(e,t)=>SortUtil.ascSort(e.year,t.year),isEmptyMessage:`<div class="flex-vh-center my-1 italic w-100">(No named years)</div>`}),l=this._render_getChildMeta("eras",TimeTrackerRoot_Settings_Era,"Era",TimeTrackerRoot.getGenericEra,{fnSort:(e,t)=>SortUtil.ascSort(e.startYear,t.startYear),isEmptyMessage:`<div class="flex-vh-center my-1 italic w-100">(No eras)</div>`}),_=this._render_getChildMeta("moons",TimeTrackerRoot_Settings_Moon,"Moon",TimeTrackerRoot.getGenericMoon,{fnSort:(e,t)=>SortUtil.ascSort(e.phaseOffset,t.phaseOffset)||SortUtil.ascSort(e.name,t.name),isEmptyMessage:`<div class="flex-vh-center my-1 italic w-100">(No moons)</div>`}),f=$$`<div class="no-shrink w-100 mb-2">
			<div class="split-v-center mb-2"><div class="w-100">Hours per Day</div>${n("hoursPerDay")}</div>
			<div class="split-v-center mb-2"><div class="w-100">Minutes per Hour</div>${n("minutesPerHour")}</div>
			<div class="split-v-center"><div class="w-100">Seconds per Minute</div>${n("secondsPerMinute")}</div>
		</div>`,m=s("hoursPerDay","minutesPerHour","secondsPerMinute"),g=d("isClockSectionHidden",f,m),h=$$`<div class="split-v-center mb-2"><div class="bold">Clock</div><div>${m}${g}</div></div>`,S=$$`<div class="no-shrink w-100 mb-2">
			<label class="split-v-center mb-2"><div class="w-100">Show Calendar Column Labels</div>${ComponentUiUtil.$getCbBool(this._parent.component,"hasCalendarLabelsColumns")}</label>
			<label class="split-v-center mb-2"><div class="w-100">Show Calendar Row Labels</div>${ComponentUiUtil.$getCbBool(this._parent.component,"hasCalendarLabelsRows")}</label>
		</div>`,E=s("hoursPerDay","minutesPerHour","secondsPerMinute"),y=d("isCalendarSectionHidden",S,E),T=$$`<div class="split-v-center mb-2"><div class="bold">Calendar</div><div>${E}${y}</div></div>`,D=$$`<div class="no-shrink w-100 mb-2">
			<div class="split-v-center mb-2"><div class="w-100">Hours per Long rest</div>${n("hoursPerLongRest")}</div>
			<div class="split-v-center mb-2"><div class="w-100">Minutes per Short Rest</div>${n("minutesPerShortRest")}</div>
			<div class="split-v-center"><div class="w-100">Seconds per Round</div>${n("secondsPerRound")}</div>
		</div>`,P=s("hoursPerLongRest","minutesPerShortRest","secondsPerRound"),M=d("isMechanicsSectionHidden",D,P),I=$$`<div class="split-v-center mb-2"><div class="bold">Game Mechanics</div><div>${P}${M}</div></div>`,k=$$`<div class="no-shrink w-100 mb-2">
			<div class="split-v-center mb-2"><div class="w-100 help" title="For example, to have the starting year be &quot;Year 900,&quot; enter &quot;899&quot;.">Year Offset</div>${n("offsetYears",{isAllowNegative:!0})}</div>
			<div class="split-v-center"><div class="w-100 help" title="For example, to have the first year start on the third day of the week, enter &quot;2&quot;.">Year Start Weekday Offset</div>${n("offsetMonthStartDay")}</div>
		</div>`,C=s("offsetYears","offsetMonthStartDay"),H=d("isOffsetsSectionHidden",k,C),A=$$`<div class="split-v-center mb-2"><div class="bold">Offsets</div><div>${C}${H}</div></div>`,v=$$`<div class="no-shrink w-100">
			<div class="split-v-center w-100 mb-1 mt-1">
				<div>Name</div>
				${r.$btnAdd}
			</div>
			${r.$wrp}
		</div>`,O=d("isDaysSectionHidden",v),w=$$`<div class="split-v-center mb-1"><div class="bold">Days</div>${O}</div>`,R=$$`<div class="no-shrink w-100">
			<div class="flex w-100 mb-1 mt-1">
				<div class="w-100 flex-v-center">Name</div>
				<div class="w-25 no-shrink text-center mr-2">Days</div>
				<div class="dm-time__spc-drag-header no-shrink mr-2"/>
				${u.$btnAdd.addClass("no-shrink")}
			</div>
			${u.$wrp}
		</div>`,b=d("isMonthsSectionHidden",R),N=$$`<div class="split-v-center mb-1"><div class="bold">Months</div>${b}</div>`,U=$$`<div class="no-shrink w-100">
			<div class="flex w-100 mb-1 mt-1">
				<div class="w-100 flex-v-center">Name</div>
				<div class="w-15 no-shrink text-center mr-2 help--subtle" title="In hours. For example, to have the sun rise at 05:00, enter &quot;5&quot;.">Sunrise</div>
				<div class="w-15 no-shrink text-center mr-2 help--subtle" title="In hours. For example, to have the sun set at 22:00, enter &quot;22&quot;.">Sunset</div>
				<div class="w-15 no-shrink text-center mr-2 help--subtle" title="For example, to have a season start on the 1st day of the year, enter &quot;1&quot;.">Start</div>
				<div class="w-15 no-shrink text-center mr-2 help--subtle" title="For example, to have a season end on the 90th day of the year, enter &quot;90&quot;.">End</div>
				${p.$btnAdd.addClass("no-shrink")}
			</div>
			${p.$wrp}
		</div>`,x=d("isSeasonsSectionHidden",U),B=$$`<div class="split-v-center mb-1"><div class="bold">Seasons</div>${x}</div>`,W=$$`<div class="no-shrink w-100">
			<div class="flex w-100 mb-1 mt-1">
				<div class="w-100 flex-v-center">Name</div>
				<div class="w-25 no-shrink text-center mr-2">Year</div>
				${c.$btnAdd.addClass("no-shrink")}
			</div>
			${c.$wrp}
		</div>`,F=d("isYearsSectionHidden",W),L=$$`<div class="split-v-center mb-1"><div class="bold">Named Years</div>${F}</div>`,Y=$$`<div class="no-shrink w-100">
			<div class="flex w-100 mb-1 mt-1">
				<div class="w-100 flex-v-center">Name</div>
				<div class="w-15 no-shrink text-center mr-2">Abbv.</div>
				<div class="w-15 no-shrink text-center mr-2">Start</div>
				<div class="w-15 no-shrink text-center mr-2">End</div>
				${l.$btnAdd.addClass("no-shrink")}
			</div>
			${l.$wrp}
		</div>`,G=d("isErasSectionHidden",Y),K=$$`<div class="split-v-center mb-1"><div class="bold">Eras</div>${G}</div>`,X=$$`<div class="no-shrink w-100">
			<div class="flex w-100 mb-1 mt-1">
				<div class="w-100 flex-v-center">Moon</div>
				<div class="w-25 no-shrink text-center mr-2 help--subtle" title="For example, to have a new moon appear on the third day of the first year, enter &quot;3&quot;.">Offset</div>
				<div class="w-25 no-shrink text-center mr-2 help--subtle" title="Measured in days. Multiples of eight are recommended, as there are eight distinct moon phases.">Period</div>
				${_.$btnAdd.addClass("no-shrink")}
			</div>
			${_.$wrp}
		</div>`,q=d("isMoonsSectionHidden",X),z=$$`<div class="split-v-center mb-1"><div class="bold">Moons</div>${q}</div>`;a.forEach(e=>e()),$$`<div class="flex-col pl-2 pr-3">
			${h}
			${f}
			<hr class="hr-0 mb-2">
			${T}
			${S}
			<hr class="hr-0 mb-2">
			${I}
			${D}
			<hr class="hr-0 mb-2">
			${A}
			${k}
			<hr class="hr-0 mb-2">
			<div class="split-v-center"><div class="w-100">Wind Speed Units</div>${i}</div>
			<hr class="hr-2">
			${w}
			${v}
			<hr class="hr-0 mt-1 mb-2">
			${N}
			${R}
			<hr class="hr-0 mt-1 mb-2">
			${B}
			${U}
			<hr class="hr-0 mt-1 mb-2">
			${L}
			${W}
			<hr class="hr-0 mt-1 mb-2">
			${K}
			${Y}
			<hr class="hr-0 mt-1 mb-2">
			${z}
			${X}
		</div>`.appendTo(e)}_render_getChildMeta(e,t,n,a,d){d=d||{};const s=$(`<div class="flex-col w-100 relative"/>`);let i;const o=()=>{const n=Object.values(this._parent.get(e)).filter(e=>!e.isDeleted);d.fnSort?n.sort(d.fnSort):(n.sort((e,t)=>SortUtil.ascSort(e.pos,t.pos)),n.forEach((e,t)=>e.pos=t));CollectionUtil.deepEquals(i,n)||(i=n,s.empty(),this._tmpComps[e]=[],n.forEach(n=>{const a=new t(this._board,this._$wrpPanel);this._tmpComps[e].push(a),a.setStateFrom({state:n}),a._addHookAll("state",()=>this._parent.set(e,(this._tmpComps[e]||[]).map(e=>e.getState()).filter(e=>!e.isDeleted).map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{}))),a.render(s,this._tmpComps,e)}),!n.length&&d.isEmptyMessage&&s.append(d.isEmptyMessage))};this._parent.addHook(e,o),o();const r=$(`<button class="btn btn-xs btn-primary" title="Add ${n}"><span class="glyphicon glyphicon-plus"/></button>`).click(()=>{const t=Object.values(this._parent.get(e)),n=t.some(e=>null!=e.pos);if(n){const n=t.filter(e=>!e.isDeleted).map(e=>e.pos),d=n.length?Math.max(...n):-1,s=a(d+1);this._parent.set(e,{...this._parent.get(e),[s.id]:s})}else{const n=a(t.length);this._parent.set(e,{...this._parent.get(e),[n.id]:n})}});return{$wrp:s,$btnAdd:r}}}class TimeTrackerRoot_Settings_Day extends TimeTrackerComponent{constructor(e,t){super(e,t),this._$rendered=null}render(e,t,n){const a=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),d=DragReorderUiUtil.$getDragPad({$parent:e,componentsParent:t,componentsProp:n,componentId:this._state.id,marginSide:"r"}),s=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Day"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);this._$rendered=$$`<div class="flex my-1 dm-time__row-delete">
			${a}
			${d}
			${s} 
			<div class="dm-time__spc-button"/>
		</div>`.appendTo(e)}get id(){return this._state.id}set pos(e){this._state.pos=e}get pos(){return this._state.pos}get height(){return this._$rendered?this._$rendered.outerHeight(!0):0}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__DAY}}}class TimeTrackerRoot_Settings_Month extends TimeTrackerComponent{constructor(e,t){super(e,t),this._$rendered=null}render(e,t,n){const a=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),d=ComponentUiUtil.$getIptInt(this,"days",1,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-25 no-shrink">`),min:TimeTrackerBase._MIN_TIME,max:TimeTrackerBase._MAX_TIME}),s=DragReorderUiUtil.$getDragPad({$parent:e,componentsParent:t,componentsProp:n,componentId:this._state.id,marginSide:"r"}),i=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Month"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);this._$rendered=$$`<div class="flex my-1 dm-time__row-delete">
			${a} 
			${d} 
			${s}
			${i} 
			<div class="dm-time__spc-button"/>
		</div>`.appendTo(e)}get id(){return this._state.id}set pos(e){this._state.pos=e}get pos(){return this._state.pos}get height(){return this._$rendered?this._$rendered.outerHeight(!0):0}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__MONTH}}}class TimeTrackerRoot_Settings_Event extends TimeTrackerComponent{render(e,t,n){const{getTimeInfo:a}=t,d=()=>{const e=this._state.entries.length&&!this._state.isHidden;o.toggleClass("hidden",!e)},s=$(`<div class="stats stats--book dm-time__wrp-event-entries"/>`),i=()=>{s.html(Renderer.get().render({entries:MiscUtil.copy(this._state.entries)})),d()};this._addHookBase("entries",i);const o=$$`<div class="flex">
			<div class="no-shrink dm-time__bar-entry"></div>
			${s}
		</div>`,r=$(`<input class="form-control input-xs form-control--minimal mr-2 w-100">`).change(()=>this._state.name=r.val().trim()||"(Unnamed event)"),u=()=>r.val(this._state.name||"(Unnamed event)");this._addHookBase("name",u);const p=$(`<button class="btn btn-xs btn-default mr-2 no-shrink"><span class="glyphicon glyphicon-eye-close"/></button>`).click(()=>this._state.isHidden=!this._state.isHidden),c=()=>{p.toggleClass("active",!!this._state.isHidden),d()};this._addHookBase("isHidden",c);const l=$(`<button class="btn btn-xs btn-default mr-2 no-shrink"><span class="glyphicon glyphicon-pencil" title="Edit Event"/></button>`).click(()=>this.doOpenEditModal()),_=$(`<input type="checkbox">`).prop("checked",this._state.hasTime).change(()=>{const e=_.prop("checked");if(e){const{secsPerDay:e}=a({isBase:!0});null==this.__state.timeOfDaySecs&&(this.__state.timeOfDaySecs=Math.floor(e/2)),this._state.hasTime=!0}else this._state.hasTime=!1});let f;if(this._state.hasTime){const e=a({isBase:!0}),t={hours:0,minutes:0,seconds:0,timeOfDaySecs:this._state.timeOfDaySecs};null!=this._state.timeOfDaySecs&&Object.assign(t,TimeTrackerBase.getHoursMinutesSecondsFromSeconds(e.secsPerHour,e.secsPerMinute,this._state.timeOfDaySecs)),f=TimeTrackerBase.getClockInputs(e,t,e=>{this._state.timeOfDaySecs=e})}const m=$(`<button class="btn btn-xs btn-default mr-2 no-shrink"><span class="glyphicon glyphicon-move" title="Move Event"/></button>`).click(()=>{n({title:"Choose Event Day",fnClick:(e,t,n)=>{this._state.when={day:n,year:t}},prop:"events"})}),g=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Event"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);i(),u(),c(),$$`<div class="flex-col py-1 px-2 stripe-even">
			<div class="flex w-100">
				${r}
				${p}
				${l} 
				<label class="flex-v-center ${f?"mr-2":"mr-3"}"> 
					<div class="mr-1 no-wrap">Has Time?</div>
					${_} 
				</label> 
				${f?$$`<div class="flex-v-center mr-3">
					${f.$iptHours}
					<div>:</div>
					${f.$iptMinutes}
					<div>:</div>
					${f.$iptSeconds}
				</div>`:""}
				${m}
				${g}
			</div>
			${o}
		</div>`.appendTo(e)}doOpenEditModal(e="transparent"){const t=new BaseComponent;t._state.name=this._state.name,t._state.entries=MiscUtil.copy(this._state.entries);const{$modalInner:n,doClose:a}=UiUtil.getShowModal({title:"Edit Event",overlayColor:e,cbClose:e=>{e&&(this._state.name=t._state.name,this._state.entries=MiscUtil.copy(t._state.entries))}}),d=ComponentUiUtil.$getIptStr(t,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mb-2 no-shrink">`)}),s=ComponentUiUtil.$getIptEntries(t,"entries",{$ele:$(`<textarea class="form-control input-xs form-control--minimal resize-none mb-2 h-100"/>`)}),i=$(`<button class="btn btn-default">Save</button>`).click(()=>a(!0));$$`<div class="flex-col h-100">
			${d} 
			${s} 
			<div class="flex-h-right no-shrink">${i}</div>
		</div>`.appendTo(n)}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__EVENT}}static getInstance(e,t,n,a){const d=new TimeTrackerRoot_Settings_Event(e,t);return d.setStateFrom({state:a}),d._addHookAll("state",()=>{const e=Object.values(n.get("events")).filter(e=>!(e.isDeleted||e.id===d.getState().id));n.set("events",[...e,d.getState()].map(e=>({[e.id]:e})).reduce((e,t)=>Object.assign(e,t),{}))}),d}}class TimeTrackerRoot_Settings_Season extends TimeTrackerComponent{render(e){const t=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),n=e=>ComponentUiUtil.$getIptInt(this,e,0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-15 no-shrink">`),min:0}),a=e=>ComponentUiUtil.$getIptInt(this,e,1,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-15 no-shrink">`),offset:1,min:1}),d=n("sunriseHour"),s=n("sunsetHour"),i=a("startDay"),o=a("endDay"),r=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Season"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);$$`<div class="flex my-1">
			${t} 
			${d}
			${s}
			${i} 
			${o} 
			${r} 
		</div>`.appendTo(e)}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__SEASON}}}class TimeTrackerRoot_Settings_Year extends TimeTrackerComponent{render(e){const t=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),n=ComponentUiUtil.$getIptInt(this,"year",1,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-25 no-shrink">`),offset:1,min:1}),a=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Year"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);$$`<div class="flex my-1">
			${t} 
			${n}
			${a} 
		</div>`.appendTo(e)}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__YEAR}}}class TimeTrackerRoot_Settings_Era extends TimeTrackerComponent{render(e){const t=e=>ComponentUiUtil.$getIptInt(this,e,1,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-15 no-shrink">`),offset:1,min:1}),n=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),a=ComponentUiUtil.$getIptStr(this,"abbreviation",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2 w-15 no-shrink">`)}),d=t("startYear"),s=t("endYear"),i=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Year"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);$$`<div class="flex my-1">
			${n} 
			${a} 
			${d}
			${s}
			${i} 
		</div>`.appendTo(e)}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__ERA}}}class TimeTrackerRoot_Settings_Moon extends TimeTrackerComponent{render(e){const t=ComponentUiUtil.$getIptStr(this,"name",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2">`)}),n=ComponentUiUtil.$getIptColor(this,"color",{$ele:$(`<input class="form-control input-xs form-control--minimal mr-2 no-shrink dm-time__ipt-color-moon" type="color" title="Moon Color">`)}),a=ComponentUiUtil.$getIptInt(this,"phaseOffset",0,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-25 no-shrink">`)}),d=ComponentUiUtil.$getIptInt(this,"period",1,{$ele:$(`<input class="form-control input-xs form-control--minimal text-right mr-2 w-25 no-shrink">`),min:TimeTrackerBase._MIN_TIME,max:TimeTrackerBase._MAX_TIME}),s=$(`<button class="btn btn-xs btn-danger no-shrink" title="Delete Moon"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>this._state.isDeleted=!0);$$`<div class="flex my-1">
			${t} 
			${n}
			${a} 
			${d}
			${s} 
		</div>`.appendTo(e)}getState(){return MiscUtil.copy(this._state)}_getDefaultState(){return{...TimeTrackerBase._DEFAULT_STATE__MOON}}}