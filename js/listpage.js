"use strict";class ListPage{constructor(a){this._dataSource=a.dataSource,this._dataSourcefluff=a.dataSourceFluff,this._filters=a.filters,this._filterSource=a.filterSource,this._listValueNames=a.listValueNames,this._listClass=a.listClass,this._listOptions=a.listOptions||{},this._sublistValueNames=a.sublistValueNames,this._sublistClass=a.sublistClass,this._sublistOptions=a.sublistOptions||{},this._dataProps=a.dataProps,this._bookViewOptions=a.bookViewOptions,this._tableViewOptions=a.tableViewOptions,this._hasAudio=a.hasAudio,this._renderer=Renderer.get(),this._list=null,this._filterBox=null,this._dataList=[],this._ixData=0,this._bookView=null}async pOnLoad(){await ExcludeUtil.pInitialise(),SortUtil.initHandleFilterButtonClicks();const a="string"==typeof this._dataSource?await DataUtil.loadJSON(this._dataSource):await this._dataSource();this._list=ListUtil.search({valueNames:this._listValueNames,listClass:this._listClass,...this._listOptions}),this._filterBox=await pInitFilterBox({filters:this._filters});const b=$(`.lst__wrp-search-visible`);this._list.on("updated",()=>{b.html(`${this._list.visibleItems.length}/${this._list.items.length}`)}),$(this._filterBox).on(FilterBox.EVNT_VALCHANGE,this.handleFilterChange.bind(this)),ListUtil.initSublist({valueNames:this._sublistValueNames,listClass:this._sublistClass,getSublistRow:this.getSublistItem.bind(this),...this._sublistOptions}),ListUtil.initGenericPinnable(),this._addData(a),BrewUtil.bind({filterBox:this._filterBox,sourceFilter:this._filterSource,list:this._list,pHandleBrew:async a=>this._addData(a)});try{const a=await BrewUtil.pAddBrewData();await this._pHandleBrew(a),await BrewUtil.pAddLocalBrewData()}catch(a){BrewUtil.pPurgeBrew(a)}BrewUtil.makeBrewButton("manage-brew"),await ListUtil.pLoadState(),RollerUtil.addListRollButton(),ListUtil.addListShowHide(),this._hasAudio&&Renderer.utils.bindPronounceButtons(),this._bookViewOptions&&(this._bookView=new BookModeView("bookview",this._bookViewOptions.$btnOpen,this._bookViewOptions.noneVisibleMsg,this._bookViewOptions.popTblGetNumShown,!0)),window.loadHash=this.doLoadHash.bind(this),window.loadSubHash=this.doLoadSubHash.bind(this),Hist.init(!0),ExcludeUtil.checkShowAllExcluded(this._dataList,$(`#pagecontent`))}async _pHandleBrew(a){this._addData(a)}_addData(a){if(!this._dataProps.some(b=>a[b]&&a[b].length))return;this._dataProps.forEach(b=>{a[b].forEach(a=>a.__prop=b),this._dataList=this._dataList.concat(a[b])});const b=$(`ul.${this._listClass}`);let c="";for(;this._ixData<this._dataList.length;this._ixData++){const a=this._dataList[this._ixData];ExcludeUtil.isExcluded(a.name,a.__prop,a.source)||(c+=this.getListItem(a,this._ixData))}const d=ListUtil.getSearchTermAndReset(this._list);b.append(c),this._list.reIndex(),d&&this._list.search(d),this._list.sort("name"),this._filterBox.render(),this.handleFilterChange(),ListUtil.setOptions({itemList:this._dataList,primaryLists:[this._list]}),ListUtil.bindPinButton(),Renderer.hover.bindPopoutButton(this._dataList),UrlUtil.bindLinkExportButton(this._filterBox),ListUtil.bindDownloadButton(),ListUtil.bindUploadButton(),this._tableViewOptions&&ListUtil.bindShowTableButton("btn-show-table",this._tableViewOptions.title,this._dataList,this._tableViewOptions.colTransforms,this._tableViewOptions.filter,this._tableViewOptions.sorter)}getListItem(){throw new Error(`Unimplemented!`)}handleFilterChange(){throw new Error(`Unimplemented!`)}getSublistItem(){throw new Error(`Unimplemented!`)}doLoadHash(){throw new Error(`Unimplemented!`)}doLoadSubHash(){throw new Error(`Unimplemented!`)}}